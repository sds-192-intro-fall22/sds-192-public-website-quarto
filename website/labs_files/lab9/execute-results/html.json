{
  "hash": "8217912f8eaabe55fb09c62acb4e134d",
  "result": {
    "markdown": "---\ntitle: \"Lab 9: Mapping with Leaflet\"\nauthor: \"Lindsay Poirier\"\nbibliography: ../IntroDS.bib\nformat:\n  html:\n    code-fold: false\n    df-print: paged\nexecute: \n  echo: true\nknitr:\n  opts_chunk: \n    message: false\n    warning: false\neditor: source\n---\n\n\n## Introduction\n\nIn this lab, we will build a map that visualizes unaddressed housing violations in NYC in order to identify some of the city's worst landlords. In doing so, we will gain practice in producing point maps in Leaflet. This analysis is based off of a similar analysis conducted by the [NYC Public Advocate's Office](https://advocate.nyc.gov/press/nyc-public-advocate-unveils-2021-worst-landlord-watchlist/). \n\n### Learning Goals\n\n-   Transform point data to an appropriate CRS\n-   Map point data in Leaflet\n-   Create palettes for points on maps\n-   Add legends and labels to a map\n\n## Review of Key Terms\n\n::: callout-tip\nYou may wish to reference this [reference guide](https://rstudio.github.io/leaflet/) when completing this lab.\n:::\n\nCoordinate Reference System (CRS)\n\n:   a system used to locate geographic points on different spatial projections\n\n## NYC Public Advocate's Worst Landlords Watchlist\n\nThe NYC Public Advocate (currently Jumaane D. Willaims) publishes a list of [NYC's worst landlords](https://landlordwatchlist.com/landlords) every year by tracking the number of class B and C Housing Preservation and Development (HPD) violations in buildings owned by various people and companies in the City. \n\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/JodhQODUZF0\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n\nFrom the Public Advocate's website:\n\n> Examples of Class B violations include: failing to provide self-closing public doors or adequate lighting in public areas, lack of posted Certificates of Occupancy, or failure to remove vermin. Class C violations include: immediately hazardous violations such as rodents, lead-based paint, and lack of heat, hot water, electricity, or gas.^1^ \n^1^See more [here](https://landlordwatchlist.com/about).\n\nI have already constructed a dataset documenting the 100 rental properties with the most average housing violations approved in 2021. If you want to check out the code to construct that dataset, you can review the code in `data-import.R` in [this directory](https://github.com/SDS-192-Intro/sds-192-labs/blob/main/Day30-Leaflet/data-import.R). Run the code below to import the dataset. \n\n\n## Setting Up Your Environment\n\n1. Install the following packages in your Environment:\n\n-   `install.packages(\"leaflet\")`\n-   `install.packages(\"sf\")`\n\n2. Run the code below to load today's data frames into your environment. \n\n\n::: {.cell document='show'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(leaflet)\nlibrary(RColorBrewer)\nlibrary(sf)\n\nworst_buildings <- read_csv(\"https://raw.githubusercontent.com/SDS-192-Intro/sds-192-labs/main/Day30-Leaflet/datasets/worst_buildings.csv\")\n```\n:::\n\n\n## Mapping in Leaflet\n\nWe are going to work with the `leaflet()` package to design a map of worst 100 NYC rental properties in terms of housing violations. The map will color the points by the average number of violations and size the points by the number of units in the building. At any point during these exercises, you can reference the [leaflet documentation](https://rstudio.github.io/leaflet/) to help you build out these maps. \n\n## Initialize your Map\n\nThere are three steps to initializing a map in leaflet:\n\n1. Call the `leaflet()` function to create a map widget. \n2. Call the `setView(lat = 0.00, lng = 0.00, zoom = 0)`. This function determines where the map will initially focus. We provide a set of coordinates that will be the map's center point when we load it, and a number (from 1 to 16) to indicate the level at which to zoom in on the map.  \n3. Call `addProviderTiles()` to load up provider tiles that constitute a base map. A number of different map providers have provider tiles that we can reference here. A few examples of the arguments we can supply to this function include include:\n\n* `providers$OpenStreetMap`\n* `providers$Stamen.Toner`\n* `providers$CartoDB.Positron`\n* `providers$Esri.NatGeoWorldMap`\n\nRun the code below to initialize a map. \n\n\n::: {.cell document='show'}\n\n```{.r .cell-code}\nmap1 <- leaflet(width = \"100%\") %>%\n  setView(lat = 0.00, lng = 0.00, zoom = 0) %>%\n  addProviderTiles(providers$Stamen.Toner)\n\nmap1\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-eca6c173bfd5cfffcfa0\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-eca6c173bfd5cfffcfa0\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[0,0],0,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"Stamen.Toner\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]}]},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n###### Question\n\n::: question\n\nAdjust the code below to center the map on NYC. You'll need to look up the coordinates for NYC, keeping in mind that South and West coordinates will be negative. Adjust the `zoom` to keep the whole city in view (setting the zoom level between 1 and 16). When you are happy with the View, switch out the provider tiles to a base map that won't distract from the data points we will layer on top of this map. Keep in mind our discussions regarding *Visualization Aesthetics* here. \n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnyc_map <- leaflet(width = \"100%\") %>%\n  setView(lat = 0.00, lng = 0.00, zoom = 0) %>%\n  addProviderTiles(providers$Stamen.Toner)\n\n# Uncomment below to view the map!\n# nyc_map\n```\n:::\n\n::: {.cell document='solutions'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-e90532847d023553367e\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-e90532847d023553367e\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]}]},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n#######\n\n## Set Geometry and Transform Data CRS\n\nWe will be looking to convert our data into an object with coordinate-based geometry so that we can map it. We can use the `st_as_sf()` function to do this. `st_as_sf()` takes two arguments: \n\n1. The names of the columns in our data frame containing geographic coodinates in the format `coords = c(\"<longitude column names>\", \"<latitude column name>\")` \n2. The coordinate reference system that the dataset currently uses in the format `crs = <crs number>`. \n\nAfter adding this geometry column with `st_as_sf()`, we need to make sure that the CRS for our coordinates is consistent with the CRS of the basemap we will be placing the points on. The coordinates in `worst_buildings` data are in NAD 83 (EPSG:4269) and our basemap is in WGS 84 (EPSG:4326). \n\n###### Question\n\n::: question\n\nIn the code block below, create a new `geometry` column with the given coordinates, using the function `st_as_sf()`. The column for longitude will go in the first coordinate position, and latitude will go in the second. Be sure to set the data's current CRS (4269) in that function. \nThen transform the CRS to 4326 using `st_transform()`. \n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Uncomment and fill in the blanks below. The column for longitude will go in the first coordinate position, and latitude will go in the second. \n\n#worst_buildings <- worst_buildings %>%\n#  st_as_sf(coords = c(\"____\", \"____\"), crs = ____) %>%\n#  st_transform(____)\n```\n:::\n\n::: {.cell document='solutions'}\n\n:::\n\n\n## Add Layers\n\nOnce we have our initial map, we can add layers to the map that display different forms of geospatial data. There are a number of different functions in leaflet that we can use to add layers. For instance, we can add markers to the map at a certain geo-coordinates using the [`addMarkers()` function](https://rstudio.github.io/leaflet/markers.html). We can also add polygons and rectangles to the map using the `addRectangles()` function or the `addPolygons()` function. Today we are going to work exclusively with the `addCircleMarkers()` function. This allows us to add a circle at the latitude and longitude for each row in our dataset. It also allows us to adjust the circle's color and size according to values in our dataset. \n\n###### Question\n\n::: question\n\nIn the code block below, pipe `addCircleMarkers()` onto the basemap and list `data = worst_buildings` as an argument in that function. It should look like my map below. \n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Uncomment and add the function\n\n#nyc_map %>%\n```\n:::\n\n::: {.cell document='solutions'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-dce19327c204c4d386a1\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-dce19327c204c4d386a1\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[40.827911,40.76809,40.836734,40.689512,40.863955,40.814015,40.824975,40.818035,40.825678,40.812821,40.679718,40.676181,40.696177,40.826287,40.818868,40.791649,40.803813,40.861234,40.832613,40.748297,40.700651,40.812883,40.813175,40.803336,40.875282,40.601257,40.671074,40.687118,40.877059,40.906152,40.863869,40.800206,40.808439,40.860924,40.675365,40.848784,40.722929,40.839424,40.862552,40.6768,40.665478,40.832489,40.818535,40.662243,40.686955,40.672452,40.676246,40.829399,40.721349,40.681988,40.664145,40.848792,40.831364,40.670086,40.65372,40.819155,40.855583,40.824936,40.829116,40.841773,40.829462,40.840612,40.685362,40.879615,40.681304,40.671121,40.691424,40.671453,40.677841,40.847043,40.826066,40.804618,40.824107,40.668874,40.652365,40.784694,40.758433,40.855329,40.6859,40.612466,40.808533,40.674142,40.576105,40.825105,40.843515,40.831084,40.811258,40.666075,40.817996,40.836472,40.630096,40.685309,40.873731,40.652807,40.851035,40.831448,40.644221,40.815372,40.61634,40.861702],[-73.904195,-73.986148,-73.937683,-73.857982,-73.919313,-73.915475,-73.949104,-73.940323,-73.948637,-73.908226,-73.937018,-73.95133,-73.93574,-73.941938,-73.954214,-73.93857,-73.95391,-73.906291,-73.904676,-73.874949,-73.914642,-73.943915,-73.95231,-73.964707,-73.847547,-73.747921,-73.866042,-73.949336,-73.909248,-73.848258,-73.921883,-73.952489,-73.956139,-73.906598,-73.867137,-73.930392,-73.868922,-73.845226,-73.918367,-73.948319,-73.955938,-73.940859,-73.941356,-73.887989,-73.918027,-73.932526,-73.909287,-73.922802,-73.979852,-73.943632,-73.887907,-73.934613,-73.870121,-73.954767,-73.957221,-73.95274,-73.897879,-73.946918,-73.939876,-73.834707,-73.940797,-73.912796,-73.929527,-73.867354,-73.941289,-73.915941,-73.915465,-73.876308,-74.000909,-73.90557,-73.939568,-73.949817,-73.952801,-73.949317,-73.931451,-73.851041,-73.822248,-73.92865,-73.950667,-74.083175,-73.9407,-73.952871,-74.000922,-73.893894,-73.886672,-73.90702,-73.940004,-73.930305,-73.938032,-73.940874,-73.944757,-73.91945,-73.877906,-73.931519,-73.939307,-73.920162,-73.959887,-73.957345,-74.081184,-73.926969],10,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"#03F\",\"weight\":5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"#03F\",\"fillOpacity\":0.2},null,null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[40.576105,40.906152],\"lng\":[-74.083175,-73.747921]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n#######\n\nMap isn't so legible/beautiful at this point, right?\n\n## Styling the Map\n\n###### Question\n\n::: question\n\nMap isn't so legible/beautiful at this point, right? Copy the map you just created into the code chunk below, and pipe the `addCircleMarkers()` function onto your code. Check out the help pages for the `addCircleMarkers()` function, and add some arguments to help with the map's legibility. At the very least, you should adjust the `radius`, `weight`, `color`, `fillColor`, and `fillOpacity`, and understand how each of these arguments will change the style of the map. For now you can set the `color` to \"black\" and the `fillColor` to \"white\". See if you can get your map to match mine below. \n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Copy previous map here! \n```\n:::\n\n::: {.cell document='solutions'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-f8a1eaf2dcdd20df47df\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-f8a1eaf2dcdd20df47df\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[40.827911,40.76809,40.836734,40.689512,40.863955,40.814015,40.824975,40.818035,40.825678,40.812821,40.679718,40.676181,40.696177,40.826287,40.818868,40.791649,40.803813,40.861234,40.832613,40.748297,40.700651,40.812883,40.813175,40.803336,40.875282,40.601257,40.671074,40.687118,40.877059,40.906152,40.863869,40.800206,40.808439,40.860924,40.675365,40.848784,40.722929,40.839424,40.862552,40.6768,40.665478,40.832489,40.818535,40.662243,40.686955,40.672452,40.676246,40.829399,40.721349,40.681988,40.664145,40.848792,40.831364,40.670086,40.65372,40.819155,40.855583,40.824936,40.829116,40.841773,40.829462,40.840612,40.685362,40.879615,40.681304,40.671121,40.691424,40.671453,40.677841,40.847043,40.826066,40.804618,40.824107,40.668874,40.652365,40.784694,40.758433,40.855329,40.6859,40.612466,40.808533,40.674142,40.576105,40.825105,40.843515,40.831084,40.811258,40.666075,40.817996,40.836472,40.630096,40.685309,40.873731,40.652807,40.851035,40.831448,40.644221,40.815372,40.61634,40.861702],[-73.904195,-73.986148,-73.937683,-73.857982,-73.919313,-73.915475,-73.949104,-73.940323,-73.948637,-73.908226,-73.937018,-73.95133,-73.93574,-73.941938,-73.954214,-73.93857,-73.95391,-73.906291,-73.904676,-73.874949,-73.914642,-73.943915,-73.95231,-73.964707,-73.847547,-73.747921,-73.866042,-73.949336,-73.909248,-73.848258,-73.921883,-73.952489,-73.956139,-73.906598,-73.867137,-73.930392,-73.868922,-73.845226,-73.918367,-73.948319,-73.955938,-73.940859,-73.941356,-73.887989,-73.918027,-73.932526,-73.909287,-73.922802,-73.979852,-73.943632,-73.887907,-73.934613,-73.870121,-73.954767,-73.957221,-73.95274,-73.897879,-73.946918,-73.939876,-73.834707,-73.940797,-73.912796,-73.929527,-73.867354,-73.941289,-73.915941,-73.915465,-73.876308,-74.000909,-73.90557,-73.939568,-73.949817,-73.952801,-73.949317,-73.931451,-73.851041,-73.822248,-73.92865,-73.950667,-74.083175,-73.9407,-73.952871,-74.000922,-73.893894,-73.886672,-73.90702,-73.940004,-73.930305,-73.938032,-73.940874,-73.944757,-73.91945,-73.877906,-73.931519,-73.939307,-73.920162,-73.959887,-73.957345,-74.081184,-73.926969],3,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"black\",\"weight\":0.5,\"opacity\":0.5,\"fill\":true,\"fillColor\":\"white\",\"fillOpacity\":0.5},null,null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[40.576105,40.906152],\"lng\":[-74.083175,-73.747921]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### Creating Color Palettes\n\nNow that our map is looking more legible, let's color the circles by the 2021 average open violations at each property on the map. Remembering back to our lesson on *Understanding Datasets* and *Visualization Aesthetics*, we should keep in mind that `avg_violations_weighted` is a numeric variable, and therefore, we will create a sequential color palette to map it. \n\nThere are three functions in leaflet for creating a sequential color palette: \n\n1. `colorNumeric()`: Creates a palette by assigning numbers to different colors on a spectrum\n2. `colorBin()`:  Creates a palette by grouping numbers into a specified number of *equally-spaced* intervals (e.g. 0-10, >10-20, >20-30)\n3. `colorQuantile()`: Creates a palette by grouping numbers into a specified number of *equally-sized* quantiles\n\n> Note that we would use `colorFactor()` to create a categorical palette.\n\nEach function takes both of the following arguments:\n\n-   `palette`: the colors we wish to map to the data. We will use preset palettes from the `RColorBrewer`. You can call `display.brewer.all()` to see the list of palettes or reference here: http://applied-r.com/rcolorbrewer-palettes/\n-   `domain`: the values we wish to apply the palette to. Here we reference the column from the data frame we wish to color the points by using the accessor `$`. \n\nIn addition, the `colorBin()` function takes the argument `bins`, which indicates the number of color intervals to be created. The `colorQuantile()` functions takes the argument `n`, which indicates the number of quantiles to map data into.\n\n###### Question\n\n::: question\n\nCreate three palettes below (one using each function `colorNumeric()`, `colorBin()`, and `colorQuantile()`), setting the `palette` to \"YlOrRd\", and the domain to `worst_buildings$avg_violations_weighted`. For `colorBin()`, set the `bins` to 4, and for `colorQuantile()`, set `n` to 4.\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\npal_num <- colorNumeric(palette=\"YlOrRd\", \n                        domain = worst_buildings$avg_violations_weighted)\n#Uncomment below to create the other two palettes.\n\n#pal_bin <- \n\n#pal_quant <- \n```\n:::\n\n::: {.cell document='solutions'}\n\n:::\n\n\n\n###### Question\n\n::: question\n\nCopy and paste the last map you created into the code chunk below, three times. For each, we are going to adjust the `fillColor` by setting it to the variable from the dataset that we wish to color (`avg_violations_weighted`), colored by one of the palettes that we created. We can do this by setting the fill color argument equal to:\n\n-   `~pal_num(avg_violations_weighted)`: for coloring the points according the `pal_num()` palette we created on the `avg_violations_weighted` variable\n-   `~pal_bin(avg_violations_weighted)`: for coloring the points according the `pal_bin()` palette we created on the `avg_violations_weighted` variable\n-   `~pal_quant(avg_violations_weighted)`: for coloring the points according the `pal_quant` palette we created on the `avg_violations_weighted()` variable\n\nYour maps should look like mine below. \n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Copy map first time here!\n\n# Copy map second time here!\n\n# Copy map third time here!\n```\n:::\n\n::: {.cell document='solutions'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-3696d64255823915a65d\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-3696d64255823915a65d\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[40.827911,40.76809,40.836734,40.689512,40.863955,40.814015,40.824975,40.818035,40.825678,40.812821,40.679718,40.676181,40.696177,40.826287,40.818868,40.791649,40.803813,40.861234,40.832613,40.748297,40.700651,40.812883,40.813175,40.803336,40.875282,40.601257,40.671074,40.687118,40.877059,40.906152,40.863869,40.800206,40.808439,40.860924,40.675365,40.848784,40.722929,40.839424,40.862552,40.6768,40.665478,40.832489,40.818535,40.662243,40.686955,40.672452,40.676246,40.829399,40.721349,40.681988,40.664145,40.848792,40.831364,40.670086,40.65372,40.819155,40.855583,40.824936,40.829116,40.841773,40.829462,40.840612,40.685362,40.879615,40.681304,40.671121,40.691424,40.671453,40.677841,40.847043,40.826066,40.804618,40.824107,40.668874,40.652365,40.784694,40.758433,40.855329,40.6859,40.612466,40.808533,40.674142,40.576105,40.825105,40.843515,40.831084,40.811258,40.666075,40.817996,40.836472,40.630096,40.685309,40.873731,40.652807,40.851035,40.831448,40.644221,40.815372,40.61634,40.861702],[-73.904195,-73.986148,-73.937683,-73.857982,-73.919313,-73.915475,-73.949104,-73.940323,-73.948637,-73.908226,-73.937018,-73.95133,-73.93574,-73.941938,-73.954214,-73.93857,-73.95391,-73.906291,-73.904676,-73.874949,-73.914642,-73.943915,-73.95231,-73.964707,-73.847547,-73.747921,-73.866042,-73.949336,-73.909248,-73.848258,-73.921883,-73.952489,-73.956139,-73.906598,-73.867137,-73.930392,-73.868922,-73.845226,-73.918367,-73.948319,-73.955938,-73.940859,-73.941356,-73.887989,-73.918027,-73.932526,-73.909287,-73.922802,-73.979852,-73.943632,-73.887907,-73.934613,-73.870121,-73.954767,-73.957221,-73.95274,-73.897879,-73.946918,-73.939876,-73.834707,-73.940797,-73.912796,-73.929527,-73.867354,-73.941289,-73.915941,-73.915465,-73.876308,-74.000909,-73.90557,-73.939568,-73.949817,-73.952801,-73.949317,-73.931451,-73.851041,-73.822248,-73.92865,-73.950667,-74.083175,-73.9407,-73.952871,-74.000922,-73.893894,-73.886672,-73.90702,-73.940004,-73.930305,-73.938032,-73.940874,-73.944757,-73.91945,-73.877906,-73.931519,-73.939307,-73.920162,-73.959887,-73.957345,-74.081184,-73.926969],3,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"black\",\"weight\":0.5,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#800026\",\"#8E0026\",\"#D21021\",\"#E41E1D\",\"#EF3823\",\"#F33F25\",\"#F64427\",\"#FD5B2D\",\"#FD612E\",\"#FD622F\",\"#FD6D32\",\"#FD7835\",\"#FD873A\",\"#FD883A\",\"#FD8B3B\",\"#FD903D\",\"#FEA144\",\"#FEA245\",\"#FEA847\",\"#FEA848\",\"#FEAD4A\",\"#FEB651\",\"#FEB954\",\"#FFC35E\",\"#FFC763\",\"#FFC864\",\"#FFCC68\",\"#FFCD69\",\"#FED26E\",\"#FED976\",\"#FEDC7C\",\"#FEDD7E\",\"#FEDD7F\",\"#FFDF82\",\"#FFE085\",\"#FFE085\",\"#FFE085\",\"#FFE288\",\"#FFE289\",\"#FFE38C\",\"#FFE48E\",\"#FFE48E\",\"#FFE590\",\"#FFE590\",\"#FFE793\",\"#FFE998\",\"#FFE998\",\"#FFE999\",\"#FFEA9A\",\"#FFEA9A\",\"#FFEB9B\",\"#FFEB9C\",\"#FFEB9C\",\"#FFEC9F\",\"#FFEC9F\",\"#FFED9F\",\"#FFEEA3\",\"#FFF0A7\",\"#FFF0A8\",\"#FFF0A8\",\"#FFF0A8\",\"#FFF1A9\",\"#FFF1AA\",\"#FFF1AB\",\"#FFF1AB\",\"#FFF1AB\",\"#FFF2AC\",\"#FFF2AC\",\"#FFF3AF\",\"#FFF3AF\",\"#FFF3B0\",\"#FFF6B7\",\"#FFF7B8\",\"#FFF7B8\",\"#FFF7B8\",\"#FFF7B9\",\"#FFF8BB\",\"#FFF8BB\",\"#FFF8BC\",\"#FFF8BC\",\"#FFF9BD\",\"#FFFABF\",\"#FFFABF\",\"#FFFBC1\",\"#FFFBC2\",\"#FFFBC2\",\"#FFFBC3\",\"#FFFCC4\",\"#FFFCC5\",\"#FFFDC7\",\"#FFFDC7\",\"#FFFDC8\",\"#FFFDC8\",\"#FFFDC8\",\"#FFFEC9\",\"#FFFEC9\",\"#FFFEC9\",\"#FFFECA\",\"#FFFFCC\",\"#FFFFCC\"],\"fillOpacity\":0.5},null,null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[40.576105,40.906152],\"lng\":[-74.083175,-73.747921]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-e4e426c850477cf5f741\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-e4e426c850477cf5f741\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[40.827911,40.76809,40.836734,40.689512,40.863955,40.814015,40.824975,40.818035,40.825678,40.812821,40.679718,40.676181,40.696177,40.826287,40.818868,40.791649,40.803813,40.861234,40.832613,40.748297,40.700651,40.812883,40.813175,40.803336,40.875282,40.601257,40.671074,40.687118,40.877059,40.906152,40.863869,40.800206,40.808439,40.860924,40.675365,40.848784,40.722929,40.839424,40.862552,40.6768,40.665478,40.832489,40.818535,40.662243,40.686955,40.672452,40.676246,40.829399,40.721349,40.681988,40.664145,40.848792,40.831364,40.670086,40.65372,40.819155,40.855583,40.824936,40.829116,40.841773,40.829462,40.840612,40.685362,40.879615,40.681304,40.671121,40.691424,40.671453,40.677841,40.847043,40.826066,40.804618,40.824107,40.668874,40.652365,40.784694,40.758433,40.855329,40.6859,40.612466,40.808533,40.674142,40.576105,40.825105,40.843515,40.831084,40.811258,40.666075,40.817996,40.836472,40.630096,40.685309,40.873731,40.652807,40.851035,40.831448,40.644221,40.815372,40.61634,40.861702],[-73.904195,-73.986148,-73.937683,-73.857982,-73.919313,-73.915475,-73.949104,-73.940323,-73.948637,-73.908226,-73.937018,-73.95133,-73.93574,-73.941938,-73.954214,-73.93857,-73.95391,-73.906291,-73.904676,-73.874949,-73.914642,-73.943915,-73.95231,-73.964707,-73.847547,-73.747921,-73.866042,-73.949336,-73.909248,-73.848258,-73.921883,-73.952489,-73.956139,-73.906598,-73.867137,-73.930392,-73.868922,-73.845226,-73.918367,-73.948319,-73.955938,-73.940859,-73.941356,-73.887989,-73.918027,-73.932526,-73.909287,-73.922802,-73.979852,-73.943632,-73.887907,-73.934613,-73.870121,-73.954767,-73.957221,-73.95274,-73.897879,-73.946918,-73.939876,-73.834707,-73.940797,-73.912796,-73.929527,-73.867354,-73.941289,-73.915941,-73.915465,-73.876308,-74.000909,-73.90557,-73.939568,-73.949817,-73.952801,-73.949317,-73.931451,-73.851041,-73.822248,-73.92865,-73.950667,-74.083175,-73.9407,-73.952871,-74.000922,-73.893894,-73.886672,-73.90702,-73.940004,-73.930305,-73.938032,-73.940874,-73.944757,-73.91945,-73.877906,-73.931519,-73.939307,-73.920162,-73.959887,-73.957345,-74.081184,-73.926969],3,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"black\",\"weight\":0.5,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#BD0026\",\"#BD0026\",\"#F03B20\",\"#F03B20\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\"],\"fillOpacity\":0.5},null,null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[40.576105,40.906152],\"lng\":[-74.083175,-73.747921]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-fbc8859d61f21d6c49d0\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-fbc8859d61f21d6c49d0\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[40.827911,40.76809,40.836734,40.689512,40.863955,40.814015,40.824975,40.818035,40.825678,40.812821,40.679718,40.676181,40.696177,40.826287,40.818868,40.791649,40.803813,40.861234,40.832613,40.748297,40.700651,40.812883,40.813175,40.803336,40.875282,40.601257,40.671074,40.687118,40.877059,40.906152,40.863869,40.800206,40.808439,40.860924,40.675365,40.848784,40.722929,40.839424,40.862552,40.6768,40.665478,40.832489,40.818535,40.662243,40.686955,40.672452,40.676246,40.829399,40.721349,40.681988,40.664145,40.848792,40.831364,40.670086,40.65372,40.819155,40.855583,40.824936,40.829116,40.841773,40.829462,40.840612,40.685362,40.879615,40.681304,40.671121,40.691424,40.671453,40.677841,40.847043,40.826066,40.804618,40.824107,40.668874,40.652365,40.784694,40.758433,40.855329,40.6859,40.612466,40.808533,40.674142,40.576105,40.825105,40.843515,40.831084,40.811258,40.666075,40.817996,40.836472,40.630096,40.685309,40.873731,40.652807,40.851035,40.831448,40.644221,40.815372,40.61634,40.861702],[-73.904195,-73.986148,-73.937683,-73.857982,-73.919313,-73.915475,-73.949104,-73.940323,-73.948637,-73.908226,-73.937018,-73.95133,-73.93574,-73.941938,-73.954214,-73.93857,-73.95391,-73.906291,-73.904676,-73.874949,-73.914642,-73.943915,-73.95231,-73.964707,-73.847547,-73.747921,-73.866042,-73.949336,-73.909248,-73.848258,-73.921883,-73.952489,-73.956139,-73.906598,-73.867137,-73.930392,-73.868922,-73.845226,-73.918367,-73.948319,-73.955938,-73.940859,-73.941356,-73.887989,-73.918027,-73.932526,-73.909287,-73.922802,-73.979852,-73.943632,-73.887907,-73.934613,-73.870121,-73.954767,-73.957221,-73.95274,-73.897879,-73.946918,-73.939876,-73.834707,-73.940797,-73.912796,-73.929527,-73.867354,-73.941289,-73.915941,-73.915465,-73.876308,-74.000909,-73.90557,-73.939568,-73.949817,-73.952801,-73.949317,-73.931451,-73.851041,-73.822248,-73.92865,-73.950667,-74.083175,-73.9407,-73.952871,-74.000922,-73.893894,-73.886672,-73.90702,-73.940004,-73.930305,-73.938032,-73.940874,-73.944757,-73.91945,-73.877906,-73.931519,-73.939307,-73.920162,-73.959887,-73.957345,-74.081184,-73.926969],3,null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"black\",\"weight\":0.5,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#E31A1C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FECC5C\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\"],\"fillOpacity\":0.5},null,null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[40.576105,40.906152],\"lng\":[-74.083175,-73.747921]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n###### Question\n\n::: question\n\nIn a comment below, explain the following: Why do the colors appear differently on each map? Which map best represents the distribution of values in `avg_violations_weighted`?\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Add comment here. \n```\n:::\n\n\n### Sizing the Circles\n\n###### Question\n\n::: question\n\nCopy and paste the code from above that colors `avg_violations_weighted` in bins into the code chunk below. We are going to size each circle by the number of rental units in that property. Number of units is stored in the column `legalclassa` in our dataset, so we could size the circles by setting the radius to `~legalclassa`. However, this would lead to some massive circles on our map as certain buildings have hundreds of units, and the value we supply to radius will determine the pixels of the circle on our map. To deal with this, we are going to take the square root of the units in each property using the `sqrt()` function. Set the radius to `~sqrt(legalclassa)` below.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Copy map colored by bins here!\n```\n:::\n\n::: {.cell document='solutions'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-875dd263abd2b396dde9\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-875dd263abd2b396dde9\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[40.827911,40.76809,40.836734,40.689512,40.863955,40.814015,40.824975,40.818035,40.825678,40.812821,40.679718,40.676181,40.696177,40.826287,40.818868,40.791649,40.803813,40.861234,40.832613,40.748297,40.700651,40.812883,40.813175,40.803336,40.875282,40.601257,40.671074,40.687118,40.877059,40.906152,40.863869,40.800206,40.808439,40.860924,40.675365,40.848784,40.722929,40.839424,40.862552,40.6768,40.665478,40.832489,40.818535,40.662243,40.686955,40.672452,40.676246,40.829399,40.721349,40.681988,40.664145,40.848792,40.831364,40.670086,40.65372,40.819155,40.855583,40.824936,40.829116,40.841773,40.829462,40.840612,40.685362,40.879615,40.681304,40.671121,40.691424,40.671453,40.677841,40.847043,40.826066,40.804618,40.824107,40.668874,40.652365,40.784694,40.758433,40.855329,40.6859,40.612466,40.808533,40.674142,40.576105,40.825105,40.843515,40.831084,40.811258,40.666075,40.817996,40.836472,40.630096,40.685309,40.873731,40.652807,40.851035,40.831448,40.644221,40.815372,40.61634,40.861702],[-73.904195,-73.986148,-73.937683,-73.857982,-73.919313,-73.915475,-73.949104,-73.940323,-73.948637,-73.908226,-73.937018,-73.95133,-73.93574,-73.941938,-73.954214,-73.93857,-73.95391,-73.906291,-73.904676,-73.874949,-73.914642,-73.943915,-73.95231,-73.964707,-73.847547,-73.747921,-73.866042,-73.949336,-73.909248,-73.848258,-73.921883,-73.952489,-73.956139,-73.906598,-73.867137,-73.930392,-73.868922,-73.845226,-73.918367,-73.948319,-73.955938,-73.940859,-73.941356,-73.887989,-73.918027,-73.932526,-73.909287,-73.922802,-73.979852,-73.943632,-73.887907,-73.934613,-73.870121,-73.954767,-73.957221,-73.95274,-73.897879,-73.946918,-73.939876,-73.834707,-73.940797,-73.912796,-73.929527,-73.867354,-73.941289,-73.915941,-73.915465,-73.876308,-74.000909,-73.90557,-73.939568,-73.949817,-73.952801,-73.949317,-73.931451,-73.851041,-73.822248,-73.92865,-73.950667,-74.083175,-73.9407,-73.952871,-74.000922,-73.893894,-73.886672,-73.90702,-73.940004,-73.930305,-73.938032,-73.940874,-73.944757,-73.91945,-73.877906,-73.931519,-73.939307,-73.920162,-73.959887,-73.957345,-74.081184,-73.926969],[7.14142842854285,2.44948974278318,4.69041575982343,2,5.8309518948453,3,5.47722557505166,8.48528137423857,3.87298334620742,5.74456264653803,15.7480157480236,4,1.73205080756888,5.91607978309962,4.89897948556636,19.8997487421324,4,3.3166247903554,17.9164728671689,1.73205080756888,2.44948974278318,null,5.56776436283002,9.53939201416946,1.73205080756888,6.557438524302,17.1464281994822,4.58257569495584,7.48331477354788,8.48528137423857,4.47213595499958,3.46410161513775,3.16227766016838,7.34846922834953,1.73205080756888,4.89897948556636,6.08276253029822,7.87400787401181,5.3851648071345,2.64575131106459,7.34846922834953,4.89897948556636,7.34846922834953,2.44948974278318,3,4.35889894354067,1.73205080756888,13.4536240470737,3,2.82842712474619,1.73205080756888,4.58257569495584,2,8.42614977317636,9,5,7.54983443527075,null,11.13552872566,2,5.56776436283002,7.61577310586391,1.73205080756888,9.21954445729289,2.82842712474619,1.73205080756888,1.73205080756888,2,4,1.73205080756888,6.6332495807108,4.47213595499958,5,7.21110255092798,5.8309518948453,2.44948974278318,8.88819441731559,4.47213595499958,null,11.7046999107196,2.23606797749979,3.46410161513775,2,6.48074069840786,8.54400374531753,3,3.16227766016838,2,4.79583152331272,null,25.219040425837,2.44948974278318,7.14142842854285,6.16441400296898,7,10.4880884817015,9.74679434480896,4.89897948556636,11.4891252930761,3.87298334620742],null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"black\",\"weight\":0.5,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#BD0026\",\"#BD0026\",\"#F03B20\",\"#F03B20\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\"],\"fillOpacity\":0.5},null,null,null,null,null,{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]}],\"limits\":{\"lat\":[40.576105,40.906152],\"lng\":[-74.083175,-73.747921]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n### Legends and Labels\n\n###### Question\n\n::: question\n\nAs a final step, we are going to add labels and legends to the map. Copy and paste the code from the previous step into the code chunk below. Then do the following:\n\n1. Add the `label` argument to the `addCircleMarkers()` function, and set the value to the column in our dataset that indicates the landlord's full name: `~fullname`. Run the code and check what happens when we hover over the circles. \n2. Add a pipe to the end of the `addCircleMarkers()` and then add the function `addLegend()`. Consult the help pages for the `addLegend()` function to determine how to add a legend for the meaning of the colors represented on the map. At the very least, you will need an argument for `data`, `pal`, and `values`.\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Copy previous map here!\n```\n:::\n\n::: {.cell document='solutions'}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-a600df7e2487fda51b4f\" style=\"width:100%;height:480px;\" class=\"leaflet html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a600df7e2487fda51b4f\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[40.7128,-74.006],10,[]],\"calls\":[{\"method\":\"addProviderTiles\",\"args\":[\"CartoDB.Positron\",null,null,{\"errorTileUrl\":\"\",\"noWrap\":false,\"detectRetina\":false}]},{\"method\":\"addCircleMarkers\",\"args\":[[40.827911,40.76809,40.836734,40.689512,40.863955,40.814015,40.824975,40.818035,40.825678,40.812821,40.679718,40.676181,40.696177,40.826287,40.818868,40.791649,40.803813,40.861234,40.832613,40.748297,40.700651,40.812883,40.813175,40.803336,40.875282,40.601257,40.671074,40.687118,40.877059,40.906152,40.863869,40.800206,40.808439,40.860924,40.675365,40.848784,40.722929,40.839424,40.862552,40.6768,40.665478,40.832489,40.818535,40.662243,40.686955,40.672452,40.676246,40.829399,40.721349,40.681988,40.664145,40.848792,40.831364,40.670086,40.65372,40.819155,40.855583,40.824936,40.829116,40.841773,40.829462,40.840612,40.685362,40.879615,40.681304,40.671121,40.691424,40.671453,40.677841,40.847043,40.826066,40.804618,40.824107,40.668874,40.652365,40.784694,40.758433,40.855329,40.6859,40.612466,40.808533,40.674142,40.576105,40.825105,40.843515,40.831084,40.811258,40.666075,40.817996,40.836472,40.630096,40.685309,40.873731,40.652807,40.851035,40.831448,40.644221,40.815372,40.61634,40.861702],[-73.904195,-73.986148,-73.937683,-73.857982,-73.919313,-73.915475,-73.949104,-73.940323,-73.948637,-73.908226,-73.937018,-73.95133,-73.93574,-73.941938,-73.954214,-73.93857,-73.95391,-73.906291,-73.904676,-73.874949,-73.914642,-73.943915,-73.95231,-73.964707,-73.847547,-73.747921,-73.866042,-73.949336,-73.909248,-73.848258,-73.921883,-73.952489,-73.956139,-73.906598,-73.867137,-73.930392,-73.868922,-73.845226,-73.918367,-73.948319,-73.955938,-73.940859,-73.941356,-73.887989,-73.918027,-73.932526,-73.909287,-73.922802,-73.979852,-73.943632,-73.887907,-73.934613,-73.870121,-73.954767,-73.957221,-73.95274,-73.897879,-73.946918,-73.939876,-73.834707,-73.940797,-73.912796,-73.929527,-73.867354,-73.941289,-73.915941,-73.915465,-73.876308,-74.000909,-73.90557,-73.939568,-73.949817,-73.952801,-73.949317,-73.931451,-73.851041,-73.822248,-73.92865,-73.950667,-74.083175,-73.9407,-73.952871,-74.000922,-73.893894,-73.886672,-73.90702,-73.940004,-73.930305,-73.938032,-73.940874,-73.944757,-73.91945,-73.877906,-73.931519,-73.939307,-73.920162,-73.959887,-73.957345,-74.081184,-73.926969],[7.14142842854285,2.44948974278318,4.69041575982343,2,5.8309518948453,3,5.47722557505166,8.48528137423857,3.87298334620742,5.74456264653803,15.7480157480236,4,1.73205080756888,5.91607978309962,4.89897948556636,19.8997487421324,4,3.3166247903554,17.9164728671689,1.73205080756888,2.44948974278318,null,5.56776436283002,9.53939201416946,1.73205080756888,6.557438524302,17.1464281994822,4.58257569495584,7.48331477354788,8.48528137423857,4.47213595499958,3.46410161513775,3.16227766016838,7.34846922834953,1.73205080756888,4.89897948556636,6.08276253029822,7.87400787401181,5.3851648071345,2.64575131106459,7.34846922834953,4.89897948556636,7.34846922834953,2.44948974278318,3,4.35889894354067,1.73205080756888,13.4536240470737,3,2.82842712474619,1.73205080756888,4.58257569495584,2,8.42614977317636,9,5,7.54983443527075,null,11.13552872566,2,5.56776436283002,7.61577310586391,1.73205080756888,9.21954445729289,2.82842712474619,1.73205080756888,1.73205080756888,2,4,1.73205080756888,6.6332495807108,4.47213595499958,5,7.21110255092798,5.8309518948453,2.44948974278318,8.88819441731559,4.47213595499958,null,11.7046999107196,2.23606797749979,3.46410161513775,2,6.48074069840786,8.54400374531753,3,3.16227766016838,2,4.79583152331272,null,25.219040425837,2.44948974278318,7.14142842854285,6.16441400296898,7,10.4880884817015,9.74679434480896,4.89897948556636,11.4891252930761,3.87298334620742],null,null,{\"interactive\":true,\"className\":\"\",\"stroke\":true,\"color\":\"black\",\"weight\":0.5,\"opacity\":0.5,\"fill\":true,\"fillColor\":[\"#BD0026\",\"#BD0026\",\"#F03B20\",\"#F03B20\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FD8D3C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FEB24C\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FED976\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\",\"#FFFFB2\"],\"fillOpacity\":0.5},null,null,null,null,[\"718.71 avg. open violations; 51 units; landlord: PHILIP SCHORR\",\"705 avg. open violations; 6 units; landlord: MARK TRESS\",\"629.67 avg. open violations; 22 units; landlord: SALVATORE D'AVOLA\",\"602.08 avg. open violations; 4 units; landlord: LEONARDO SIRAGUSA\",\"577.12 avg. open violations; 34 units; landlord: JULIAN RODRIGUEZ\",\"567.5 avg. open violations; 9 units; landlord: MARIO OLIVERO\",\"561.5 avg. open violations; 30 units; landlord: SIMONE ROSS\",\"538 avg. open violations; 72 units; landlord: SIMONE ROSS\",\"533.33 avg. open violations; 15 units; landlord: SALVATORE D'AVOLA\",\"532.25 avg. open violations; 33 units; landlord: ALEJANDRO QUITO\",\"522.33 avg. open violations; 248 units; landlord: ROBYN LUCAS-CORA\",\"512.62 avg. open violations; 16 units; landlord: SHAWN MALDON\",\"497 avg. open violations; 3 units; landlord: BETTY LUGO\",\"496.38 avg. open violations; 35 units; landlord: CHARLIE WINSTON\",\"493 avg. open violations; 24 units; landlord: SIMONE ROSS\",\"486.75 avg. open violations; 396 units; landlord: TAMAR SMITH\",\"461 avg. open violations; 16 units; landlord: SIMONE ROSS\",\"458.67 avg. open violations; 11 units; landlord: JOHN REILLY\",\"450.33 avg. open violations; 321 units; landlord: KARAN SINGH\",\"449.42 avg. open violations; 3 units; landlord: REBECA CERECEDO\",\"442 avg. open violations; 6 units; landlord: ISMENE SPELIOTIS\",\"427.75 avg. open violations; NA units; landlord: ASTLEY GROVES\",\"423.5 avg. open violations; 31 units; landlord: SIMONE ROSS\",\"409.33 avg. open violations; 91 units; landlord: JUAN LARA\",\"403.12 avg. open violations; 3 units; landlord: GEOFFREY SINCKLER\",\"401.67 avg. open violations; 43 units; landlord: MICHAEL ROONEY\",\"396.83 avg. open violations; 294 units; landlord: ALAN SULLIVAN\",\"394.54 avg. open violations; 21 units; landlord: STEVEN KASHANIAN\",\"387.58 avg. open violations; 56 units; landlord: RICHARD NUSSBAUM\",\"377.08 avg. open violations; 72 units; landlord: SALVATORE D'AVOLA\",\"369 avg. open violations; 20 units; landlord: SIMONE ROSS\",\"366.38 avg. open violations; 12 units; landlord: MATTHEW ROONEY\",\"365.17 avg. open violations; 10 units; landlord: MARLENE CHARLES\",\"361.04 avg. open violations; 54 units; landlord: STEVE FINKELSTEIN\",\"357.58 avg. open violations; 3 units; landlord: KENNETH AHN\",\"357 avg. open violations; 24 units; landlord: RANDY APFELBAUM\",\"356.42 avg. open violations; 37 units; landlord: JOHNATHAN SANTANA\",\"352.79 avg. open violations; 62 units; landlord: RICHARD NUSSBAUM\",\"351.5 avg. open violations; 29 units; landlord: MICHAEL SAPERSTEIN\",\"347.62 avg. open violations; 7 units; landlord: EVERTON PIERRE\",\"345.08 avg. open violations; 54 units; landlord: YITZCHAK SHWARTZ\",\"345 avg. open violations; 24 units; landlord: SIMONE ROSS\",\"342.54 avg. open violations; 54 units; landlord: CRAIG LIVINGSTON\",\"342.5 avg. open violations; 6 units; landlord: SALVATORE D'AVOLA\",\"337.71 avg. open violations; 9 units; landlord: URI MERMELSTEIN\",\"331.83 avg. open violations; 19 units; landlord: ISMENE SPELIOTIS\",\"330.58 avg. open violations; 3 units; landlord: SYED AHMED\",\"330.5 avg. open violations; 181 units; landlord: JUDA STERN\",\"329.12 avg. open violations; 9 units; landlord: FERNANDO ALFONSO\",\"329.12 avg. open violations; 8 units; landlord: ISMENE SPELIOTIS\",\"326.88 avg. open violations; 3 units; landlord: IRINI LASKARATOS\",\"326.33 avg. open violations; 21 units; landlord: JULIAN RODRIGUEZ\",\"326.21 avg. open violations; 4 units; landlord: MARYANN BROWN\",\"322.33 avg. open violations; 71 units; landlord: MICHAEL CLEMAT\",\"321.92 avg. open violations; 81 units; landlord: DAVID BLAU\",\"321.5 avg. open violations; 25 units; landlord: SIMONE ROSS\",\"316.62 avg. open violations; 57 units; landlord: LARRY HIRSCHFIELD\",\"311.5 avg. open violations; NA units; landlord: JACOB HAROONI\",\"310.5 avg. open violations; 124 units; landlord: NIKKI BERRYMAN\",\"310.42 avg. open violations; 4 units; landlord: JOHN REALI\",\"309.38 avg. open violations; 31 units; landlord: BRIAN RITTER\",\"308.33 avg. open violations; 58 units; landlord: SALVATORE D'AVOLA\",\"306.88 avg. open violations; 3 units; landlord: ARENZO MCEACHIN\",\"306.62 avg. open violations; 85 units; landlord: LOUIS CALOS\",\"306.62 avg. open violations; 8 units; landlord: DAWN MALONEY\",\"306.08 avg. open violations; 3 units; landlord: MAYER KESSLER\",\"305.42 avg. open violations; 3 units; landlord: JIMMY COHEN\",\"304.12 avg. open violations; 4 units; landlord: ALFREDO LEM\",\"301.29 avg. open violations; 16 units; landlord: CHANMATTIE PERSAUD\",\"300.79 avg. open violations; 3 units; landlord: IHSAN SALEEM\",\"300.17 avg. open violations; 44 units; landlord: CRAIG LIVINGSTON\",\"290.29 avg. open violations; 20 units; landlord: JEROME WHITE\",\"289.5 avg. open violations; 25 units; landlord: SIMONE ROSS\",\"288.79 avg. open violations; 52 units; landlord: YOSSI HOROWITZ\",\"288.71 avg. open violations; 34 units; landlord: ROBERT RAPHAEL\",\"287.42 avg. open violations; 6 units; landlord: ALDORA FARFALLA\",\"285.42 avg. open violations; 79 units; landlord: VINCENT GAROFALO\",\"285 avg. open violations; 20 units; landlord: SIMONE ROSS\",\"284.5 avg. open violations; NA units; landlord: ASAD ALI\",\"284.46 avg. open violations; 137 units; landlord: LUCRECIA PEREZ\",\"282.96 avg. open violations; 5 units; landlord: FERNANDO ALFONSO\",\"280.25 avg. open violations; 12 units; landlord: WILLIAM THOMPSON\",\"279.96 avg. open violations; 4 units; landlord: POPE BOODHAN\",\"277.42 avg. open violations; 42 units; landlord: JUAN ANAYA\",\"276.79 avg. open violations; 73 units; landlord: ALEXANDER HOFFMAN\",\"276.5 avg. open violations; 9 units; landlord: SALVATORE D'AVOLA\",\"275 avg. open violations; 10 units; landlord: SALVATORE D'AVOLA\",\"274 avg. open violations; 4 units; landlord: SALLIE VINSON\",\"273 avg. open violations; 23 units; landlord: RICARTE ECHEVARRIA\",\"270.42 avg. open violations; NA units; landlord: ANGELINA KATES\",\"270.38 avg. open violations; 636 units; landlord: DONALD ROBERTS III\",\"269 avg. open violations; 6 units; landlord: BRIAN HODGE\",\"268.88 avg. open violations; 51 units; landlord: ROBERT GOJCAJ\",\"268.08 avg. open violations; 38 units; landlord: PINCUS SCHWIMMER\",\"267.71 avg. open violations; 49 units; landlord: NATHAN SILVERSTEIN\",\"267.62 avg. open violations; 110 units; landlord: PAUL LOZITO\",\"266.96 avg. open violations; 95 units; landlord: DAVID BLAU\",\"265.5 avg. open violations; 24 units; landlord: SIMONE ROSS\",\"263.83 avg. open violations; 132 units; landlord: LUCRECIA PEREZ\",\"263.38 avg. open violations; 15 units; landlord: SALVATORE D'AVOLA\"],{\"interactive\":false,\"permanent\":false,\"direction\":\"auto\",\"opacity\":1,\"offset\":[0,0],\"textsize\":\"10px\",\"textOnly\":false,\"className\":\"\",\"sticky\":true},null]},{\"method\":\"addLegend\",\"args\":[{\"colors\":[\"#FFFFB2\",\"#FED976\",\"#FEB24C\",\"#FD8D3C\",\"#F03B20\",\"#BD0026\"],\"labels\":[\"200 &ndash; 300\",\"300 &ndash; 400\",\"400 &ndash; 500\",\"500 &ndash; 600\",\"600 &ndash; 700\",\"700 &ndash; 800\"],\"na_color\":null,\"na_label\":\"NA\",\"opacity\":0.5,\"position\":\"topright\",\"type\":\"bin\",\"title\":\"Avg. Open Housing Violations\",\"extra\":null,\"layerId\":null,\"className\":\"info legend\",\"group\":null}]}],\"limits\":{\"lat\":[40.576105,40.906152],\"lng\":[-74.083175,-73.747921]}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n#######\n\n::: callout-caution\n## Ethical Considerations\n\nThe NYC Worst Landlord Watchlist determines worst landlords based on class B and C Housing Preservation and Development (HPD) violations. ...but not every issue a tenant faces with respect to their landlord will be documented via an HPD violation. What kinds of issues might go ignored when we use these variables alone to determine worst landlords? How should we as data scientists communicate what this data shows and doesn't show? Share your ideas on our `sds-192-discussions` Slack channel.\n\n:::\n\n",
    "supporting": [
      "lab9_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<script src=\"../site_libs/jquery-1.12.4/jquery.min.js\"></script>\n<link href=\"../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/leaflet-binding-2.1.1/leaflet.js\"></script>\n<script src=\"../site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js\"></script>\n<script src=\"../site_libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js\"></script>\n<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}