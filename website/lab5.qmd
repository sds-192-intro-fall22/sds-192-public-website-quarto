---
title: "Lab 5: Exploratory Data Analysis"
author: "Lindsay Poirier"
format: html
editor: visual
bibliography: IntroDS.bib
---

## Introduction

In this lab, you will apply the 5 data wrangling verbs we learned this week in order to analyze data regarding NYPD stop, question, and frisk. Specifically, we will replicate [data analysis performed by the NYCLU](https://www.nyclu.org/en/stop-and-frisk-data) in 2011 to demonstrate how the practice was being carried out unconstitutionally in New York.

### Learning Goals

-   Answer questions with data using data wrangling verbs

-   Consider the implications of racial categorization

## Review of Key Terms

::: callout-tip
You may wish to reference this [Data Wrangling Cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf) when completing this lab.
:::

filter

:   filters to rows (observations) that meet a certain criteria

select

:   keeps only selected variables (columns)

arrange

:   sorts values in a variable (column)

summarize

:   calculates a single value by performing an operation across a variable (column); summarizing by `n()` calculates the number of observations in the column

group_by

:   groups rows (observations) by shared values in a variable (column); when paired with `summarize()`, performs an operation in each group

mutate

:   creates a new variable (column) and assigns values according to criteria we provide

## Stop, Question, and Frisk Dataset

In 1968, the Supreme Court case Terry v. Ohio ruled that a police officer could stop an individual without "probable cause" but with "reasonable suspicion" the suspect had committed a crime. Further, an officer could frisk an individual without "probable cause" but with "reasonable suspicion" the suspect was carrying a weapon.

In the early 1990s, stop, question, and frisk became a widely prevalent tactic in policing in NYC. Every time an officer stops a civilian in NYC, the officer is supposed to complete a UF-250 form (see image below) outlining the details of the stop.

[![UF250 Side 2, Dan Nguyen's Blog](img/uf250-2011-side-1.png){fig-alt="UF250 Side 2" fig-align="center" width="500"}](http://blog.danwin.com/request-nypd-form-uf250/)

[![UF250 Side 2, Dan Nguyen's Blog](img/uf250-2011-side-2.png){fig-alt="UF250 Side 2" fig-align="center"}](http://blog.danwin.com/request-nypd-form-uf250/)

As a result of some high profile shootings in the late 1990s and mid-2000s, both the New York State Attorney General's Office and the New York Civil Liberties Union began to examine NYPD stop and frisk activity for racial profiling. With pressure from these organizations, in the mid-2000s, information recorded on UF-250 forms began getting reported in public databases. In the early 2010s, when the NYPD's use of stop and frisk went before the US District Court, this data was integral in proving that stop and frisk was being carried out in NYC in an unconstitutional way. The ruling mandated that the NYPD create a policy outlining when stops were authorized, and since the practice has declined considerably. See

[@smith2018] and [@southall2019] for more information.

### Data Dictionary

We will analyze data for all stops in 2011. This data can be found [here](The%20original%20dataset%20can%20be%20found%20at:%20https://%20www1.nyc.gov/site/nypd/stats/reports-analysis/). However, we're only going to be considering a subset of the columns. Here is a data dictionary for the columns we're using in this analysis.

+--------------+---------------------------------------+--------------------------------+
| VARIABLE     | DEFINITION                            | POSSIBLE VALUES                |
+==============+=======================================+================================+
| pct          | Precinct of the stop                  | 1:123                          |
+--------------+---------------------------------------+--------------------------------+
| arrestsum    | Was an arrest made or summons issued? | 1 = Yes                        |
|              |                                       |                                |
|              |                                       | 0 = No                         |
+--------------+---------------------------------------+--------------------------------+
| frisked      | Was suspect frisked?                  | 1 = Yes                        |
|              |                                       |                                |
|              |                                       | 0 = No                         |
+--------------+---------------------------------------+--------------------------------+
| wpnfound     | Was a weapon found on suspect?        | 1 = Yes                        |
|              |                                       |                                |
|              |                                       | 0 = No                         |
+--------------+---------------------------------------+--------------------------------+
| race_cat     | Suspect's race                        | AMERICAN INDIAN/ALASKAN NATIVE |
|              |                                       |                                |
|              |                                       | ASIAN/PACIFIC ISLANDER         |
|              |                                       |                                |
|              |                                       | BLACK                          |
|              |                                       |                                |
|              |                                       | BLACK-HISPANIC                 |
|              |                                       |                                |
|              |                                       | OTHER                          |
|              |                                       |                                |
|              |                                       | WHITE                          |
|              |                                       |                                |
|              |                                       | WHITE-HISPANIC                 |
+--------------+---------------------------------------+--------------------------------+
| age          | Suspect's age                         | 999 indicates a missing value  |
+--------------+---------------------------------------+--------------------------------+

## Setting Up Your Environment

```{r}
#| warning: false
#| messages: false
library(tidyverse)

sqf_url <- "https://www1.nyc.gov/assets/nypd/downloads/zip/analysis_and_planning/stop-question-frisk/sqf-2011-csv.zip"
temp <- tempfile()
download.file(sqf_url, temp)
sqf_zip <- unzip(temp, "2011.csv")
sqf_2011 <- read.csv(sqf_zip, stringsAsFactors = FALSE) 
sqf_2011_race_cat <- read.csv("https://raw.githubusercontent.com/lindsaypoirier/STS-101/master/Data/SQF/sqf_race_categories.csv", stringsAsFactors = FALSE) 
rm(sqf_url)
rm(temp)
rm(sqf_zip)
```

### Prepare Dataset for Analysis

The original dataset codes each race with a single letter. This adds a column called `race_cat` that writes out each racial category in accordance with the data documentation. It also replaces every instance of "Y" in the dataset with 1 and every instance of "N" with 0. This will allow us to sum the Yes's in the dataset. You'll learn more about how this code works in coming weeks.

```{r}
sqf_2011 <- 
  sqf_2011 %>% 
  select(pct, race, age, frisked, pistol, riflshot, asltweap, knifcuti, machgun, othrweap, sumissue, arstmade) %>%
  left_join(sqf_2011_race_cat, by = "race") %>%
  mutate(across(frisked:arstmade, 
         ~ case_when(. == "Y" ~ 1, . == "N" ~ 0)))
rm(sqf_2011_race_cat)
```

The original dataset had separate variables for indicating whether a pistol, rifle, assault weapon, knife, machine gun, or other weapon was found on a suspect. We will create a variable equal to 1 if any of these weapons were found on the suspect. Further, the original dataset had separate variables for indicating whether a stop resulted in an arrest made or summons issued. We will create a variable equal to 1 if either occurred.

::: callout-important
## Exercise 1

Add new columns indicating 1) whether a weapon was found or 2) an arrest/summons was made.
:::

```{r eval=FALSE}
sqf_2011 <- 
  sqf_2011 %>%
  #Add a variable for weapon found
  _____(wpnfound = case_when(pistol == 1 |
                               riflshot == 1 | 
                               asltweap == 1 |
                               knifcuti == 1 | 
                               machgun == 1 | 
                               othrweap == 1 ~ 1,
                             TRUE ~ 0))
sqf_2011 <- 
  sqf_2011 %>%
  #Add a variable for arrest made or summons issued
  _____(arrestsumm = case_when(sumissue == 1 | 
                                arstmade == 1 ~ 1,
                               TRUE ~ 0))
```

::: callout-important
## Exercise 2

Subset the dataset to the six variables listed in the data dictionary above.
:::

```{r eval=FALSE}
sqf_2011 <-
  sqf_2011 %>%
  _____(pct, arrestsumm, _____, wpnfound, race_cat, _____)
```

## Analysis

::: callout-important
## Exercise 3

Calculate the number of stops in 2011. Hint: Keep in mind that every row in the dataset represents one stop.
:::

::: callout-tip
`summarize()` will return a *data frame* with the summarized value. Remember a data frame is a two-dimensional table with rows and columns (even if it's a 1x1 table). If we want **just the value**, we can call `pull()` to extract the value from that two--dimensional table.
:::

```{r eval = FALSE}
total_stops <-
  sqf_2011 %>%
  summarize(Count = _____) %>%
  pull()

total_stops
```

::: callout-important
## Exercise 4

How many stops did not result in an arrest or summons in 2011? What percentage of stops did not result in an arrest or summons?
:::

```{r eval=FALSE}
sqf_2011 %>%
  #Subset to rows where suspect innocent
  _____(arrestsumm _____ 0) %>% 
  #Calculate number of observations
  _____(total_innocent = n(), 
            percent_innocent = _____ / total_stops * 100)
```

::: callout-important
## Exercise 5

In how many stops were the individuals aged 14-24? In what percentage of stops were the individuals aged 14-24?
:::

```{r eval=FALSE}
sqf_2011 %>%
  #Subset to rows where suspect age 14-24
  _____(age _____ 14 & age _____ 24) %>% 
  #Calculate number of observations and percentage of observations
  _____(total_14_24 = _____, 
            percent_14_24 = n() / total_stops * 100)
```

Why doesn't this match the values we see on the NYCLU website?

Note the following from the [NYCLU's 2011 report on Stop, Question, and Frisk](https://www.nyclu.org/en/publications/report-nypd-stop-and-frisk-activity-2011-2012) data:

> "In a negligible number of cases, race and age information is not recorded in the database. Throughout this report, percentages of race and age are percentages of those cases where race and age are recorded, not of all stops."

```{r eval=FALSE}
total_stops_age_recorded <-
  sqf_2011 %>%
  #Subset to rows where age is not 999
  _____(age _____ 999) %>% 
  summarize(Count = n()) %>%
  pull()

sqf_2011_sub %>%
  filter(age >= 14 & age <= 24) %>%
  summarize(total_14_24 = n(), 
            percent_14_24 = n() / total_stops_age_recorded * 100)
```

This still doesn't match the values we see on the website, but it does match the values we see in the NYCLU's 2011 report on Stop, Question, and Frisk data. This is typically when I would reach out to a representative at the NYCLU to inquire about the discrepancy.

::: callout-important
## Exercise 6

How many stops were there per race in 2011? What percentage of stops per race in 2011? Arrange by number of stops in descending order.
:::

```{r eval=FALSE}
total_stops_race_recorded <-
  sqf_2011 %>%
  #Subset to rows where race_cat is not NA or "OTHER"
  filter(_____(race_cat) & race_cat _____ "OTHER") %>% 
  summarize(Count = n()) %>%
  pull()

sqf_2011 %>%
  #Subset to rows where race_cat is not NA or "OTHER"
  _____(_____(race_cat) & race_cat _____ "OTHER") %>% 
  #Group by race
  _____(race_cat) %>% 
  #Calculate number of observations
  _____(stops = n(), 
            percent_stops = n() / total_stops_race_recorded * 100) %>%
  #Sort by stops in descending order
  _____(_____(stops)) 
```

Note how this dataset categorizes race. Many different government datasets categorize race in many different ways. This, for instance, is not how the US Census categorizes race. How we categorize race matters for how we can talk about discrimination and racial profiling. Imagine if WHITE was not categorized separately from WHITE-HISPANIC. The values in this dataset would appear very differently! The NYCLU chose to aggregate two racial categories in this dataset into the one category - Latino - in order to advance certain claims regarding discrimination. What we should remember is that these racial categories are not reported by those stopped; they are recorded by officers stopping individuals. They may not reflect how individuals identify themselves.

```{r eval=FALSE}
sqf_2011 %>%
  #Subset to rows where race_cat is "WHITE-HISPANIC" or "BLACK-HISPANIC"
  _____(race_cat _____ c("WHITE-HISPANIC", "BLACK-HISPANIC")) %>% 
  #Calculate number of observations
  _____(stops_Latinx = _____, 
            percent_Latinx = n() / total_stops_race_recorded * 100)
```

::: callout-important
## Exercise 7

What percentage of stops in 2011 resulted in a frisk per race? What percentage of stops in 2011 resulted in a weapon found per race? What percentage of stops in 2011 resulted in an arrest or summons per race? In your resulting data table, each row should be a race, and there should be columns for `stops`, `percent_stops`, `percent_frisked`, `percent_wpnfound` , and `percent_arrestsum`.
:::

```{r eval=FALSE}
# Write code here. 
```

::: callout-caution
## Ethical Considerations

In her ruling in the 2011 District Court case Floyd vs. the City of New York, Honorable Shira Sheidlen remarked the following regarding the database of stops we analyzed today:

> Because it is impossible to individually analyze each of those stops, plaintiffs' case was based on the imperfect information contained in the NYPD's database of forms ("UF-250s") that officers are required to prepare after each stop. The central flaws in this database all skew toward underestimating the number of unconstitutional stops that occur: the database is incomplete, in that officers do not prepare a UF-250 for every stop they make; it is one-sided, in that the UF250 only records the officer's version of the story; the UF-250 permits the officer to merely check a series of boxes, rather than requiring the officer to explain the basis for her suspicion; and many of the boxes on the form are inherently subjective and vague (such as "furtive movements"). Nonetheless, the analysis of the UF-250 database reveals that at least 200,000 stops were made without reasonable suspicion.

What are some of the consequences of the incompleteness and/or one-sided nature of this dataset? How should we think about and communicate its flaws vs its value? How might this data collection program be redesigned so as to represent more diverse perspectives? Share your ideas on our `sds-192-discussions` Slack channel.
:::

::: callout-note
If you finish early, I encourage you to attempt to plot some of this data below using `ggplot()`!
:::
