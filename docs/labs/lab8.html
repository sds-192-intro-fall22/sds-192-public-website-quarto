<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lindsay Poirier">

<title>Lab 8: Programming with Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">SDS 192: Intro to Data Science</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Syllabus</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../grading_contract.html">Standards Grading</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">Schedule</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals">Learning Goals</a></li>
  </ul></li>
  <li><a href="#review-of-key-terms" id="toc-review-of-key-terms" class="nav-link" data-scroll-target="#review-of-key-terms">Review of Key Terms</a></li>
  <li><a href="#cmss-open-payments-dataset" id="toc-cmss-open-payments-dataset" class="nav-link" data-scroll-target="#cmss-open-payments-dataset">CMS’s Open Payments Dataset</a></li>
  <li><a href="#setting-up-your-environment" id="toc-setting-up-your-environment" class="nav-link" data-scroll-target="#setting-up-your-environment">Setting Up Your Environment</a></li>
  <li><a href="#cleaning-up-this-data-frame" id="toc-cleaning-up-this-data-frame" class="nav-link" data-scroll-target="#cleaning-up-this-data-frame">Cleaning up this Data Frame</a></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data Analysis</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 8: Programming with Data</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lindsay Poirier </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In this lab, we will program some custom <code>R</code> functions that allow us to analyze data related to medical conflicts of interest. Specifically, we will determine which ten Massachusetts-based doctors received the most money from pharmaceutical or medical device companies in 2021. Then we will leverage our custom functions to produce a number of tables and plots documenting information about the payments made to each of these doctors. In doing so, we will update a similar analysis produced by ProPublica in 2018 called <a href="https://projects.propublica.org/docdollars/"><em>Dollars for Docs</em></a>.</p>
<section id="learning-goals" class="level3">
<h3 class="anchored" data-anchor-id="learning-goals">Learning Goals</h3>
<ul>
<li>Write custom <code>R</code> functions</li>
<li>Iterate a function over the values in a vector, using family of map functions</li>
<li>Practice data cleaning and wrangling</li>
</ul>
</section>
</section>
<section id="review-of-key-terms" class="level2">
<h2 class="anchored" data-anchor-id="review-of-key-terms">Review of Key Terms</h2>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may wish to reference this <a href="https://github.com/rstudio/cheatsheets/blob/main/purrr.pdf">purrr Cheatsheet</a> when completing this lab.</p>
</div>
</div>
<dl>
<dt>Function</dt>
<dd>
<p>a series of statements that returns a value or performs a task</p>
</dd>
<dt>Iteration</dt>
<dd>
<p>repeating a task over a series of values, vectors, or lists</p>
</dd>
</dl>
</section>
<section id="cmss-open-payments-dataset" class="level2">
<h2 class="anchored" data-anchor-id="cmss-open-payments-dataset">CMS’s Open Payments Dataset</h2>
<p>In 2010, the the Physician Payments Sunshine Act (2010) was passed, requiring medical drug and device companies to disclose payments and other transfers of value made to physicians, non-physician practitioners, and teaching hospitals. This law was put into place to promote transparency in our medical system - enabling the U.S. government and citizens to monitor for potential medical conflicts of interest.</p>
<p>Today, every time a drug or medical device company makes a payment to a covered recipient, they must disclose the nature of that payment and the amount to the U.S. Centers for Medicare &amp; Medicaid. Data about payments is then aggregated, reviewed by (and sometimes disputed by) recipients, corrected, and then published as an open government dataset.</p>
<p>Definitions for what counts as a reporting entity, a covered recipient, and a reportable activity have been expanding since the passing of the Physician Payments Sunshine Act as legislators have raised concerns over the degree of transparency of diversifying financial arrangements in the healthcare system. In 2020, the first settlement for violations to the Sunshine Act was announced, requiring Medtronic Inc.&nbsp;to pay $9.2 million to resolve allegations for failure to report. This served as a signal that enforcement is ramping up in the coming years. In 2022, the state of California passed a law requiring that medical practitioners disclose to patients that this data resource exists.</p>
</section>
<section id="setting-up-your-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-your-environment">Setting Up Your Environment</h2>
<ol type="1">
<li>Run the code below to load today’s data frames into your environment.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>open_payments_original <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/sds-192-intro-fall22/sds-192-public-website-quarto/main/website/data/open_payments_ma.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(covered_recipient_npi,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>         covered_recipient_first_name<span class="sc">:</span>covered_recipient_last_name,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>         applicable_manufacturer_or_applicable_gpo_making_payment_id,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         applicable_manufacturer_or_applicable_gpo_making_payment_name,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         recipient_city,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>         recipient_state,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>         covered_recipient_specialty_1,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>         total_amount_of_payment_usdollars,</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>         indicate_drug_or_biological_or_device_or_medical_supply_1,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>         product_category_or_therapeutic_area_1,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>         name_of_drug_or_biological_or_device_or_medical_supply_1,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>         date_of_payment,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>         nature_of_payment_or_transfer_of_value,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>         number_of_payments_included_in_total_amount,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>         form_of_payment_or_transfer_of_value,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>         dispute_status_for_publication,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>         payment_publication_date) <span class="sc">|&gt;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(covered_recipient_npi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-up-this-data-frame" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-up-this-data-frame">Cleaning up this Data Frame</h2>
<p>Eventually we are going to plot some timelines of payments to specific doctors, and we will need the <code>date_of_payment</code> column to be in a date-time format to do so. To get started with cleaning up this dataset, let’s convert the date columns in <code>open_payments_original</code> to a date-time format.</p>
<section id="question" class="level6">
<h6 class="anchored" data-anchor-id="question">Question</h6>
<div class="question">
<p>Write code to convert the <code>date_of_payment</code> and the <code>payment_publication_date</code> column to date-time format. You should first determine the format of the date in <code>date_of_payment</code> and <code>payment_publication_date</code> and then reference the <a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_lubridate.pdf">lubridate</a> to determine the corresponding function for parsing that date format. Finally, you will mutate the two columns.</p>
<blockquote class="blockquote">
<p>Optional challenge: Rather than mutating each column, see if you can <code>mutate()</code> <code>across()</code> the two columns to complete this step.</p>
</blockquote>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>open_payments_dates_cleaned <span class="ot">&lt;-</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  open_payments_original <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">"date"</span>), mdy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To confirm that we’ve done this right, we can check whether both of the dates are in the date time format.</p>
</section>
<section id="question-1" class="level6">
<h6 class="anchored" data-anchor-id="question-1">Question</h6>
<div class="question">
<p>The <code>is.Date</code> function returns <code>TRUE</code> if a vector is in date-time format, and <code>FALSE</code> if it is not. Below, I’ve selected the two columns in <code>open_payments</code> that contain the word “date” in the column header. Determine which <code>map()</code> function to use in order to return a <strong>vector</strong> that indicates whether these columns are in a date-time format. If you’ve done everything correctly, you should get the output below.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>open_payments_dates_cleaned <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">"date"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_lgl</span>(is.Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         date_of_payment payment_publication_date 
                    TRUE                     TRUE </code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check out what happens if you swap out your map function above for <code>map</code>, <code>map_chr</code>, or <code>map_int</code>. Can you figure out the relationship between these values and the original values?</p>
</div>
</div>
<p>It’s important to note that the unit of observation in this dataset is not one medical practitioner, and it is not one company. Instead it is one payment from a company to a medical practitioner. That means that a medical practitioner can appear multiple times in the dataset if they’ve received multiple payments, and a medical drug or device company can appear multiple times in the dataset if they’ve disbursed multiple payments. We can identify medical practitioners with the <code>covered_recipient_npi</code> column and companies with the <code>applicable_manufacturer_or_applicable_gpo_making_payment_id</code> column.</p>
<p>…but we want to know more than just the ID of a medical practitioner. To identify which doctors are receiving the most money, we also want to know that practitioner’s name, location, specialty, etc. Because practitioners’ names are manually entered into a database every time a payment is made to them, sometimes the formatting of a practitioner’s name entered for one payment can differ from how that same practitioner’s name is formatted when entered for another payment. The same goes for other variables related to that practitioner. For instance, check out how the capitalization differs for the practitioner below. In some cases, there is a middle initial, while in others, there is a full middle name; in some cases, the practitioner’s name is all capitalized, and in other cases it is not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>open_payments_dates_cleaned <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> <span class="dv">1003040676</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(covered_recipient_first_name, covered_recipient_middle_name, covered_recipient_last_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["covered_recipient_first_name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["covered_recipient_middle_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["covered_recipient_last_name"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"CHARLES","2":"NA","3":"RESOR"},{"1":"CHARLES","2":"D.","3":"RESOR"},{"1":"CHARLES","2":"D.","3":"RESOR"},{"1":"Charles","2":"Donohue","3":"Resor"},{"1":"CHARLES","2":"D","3":"RESOR"},{"1":"CHARLES","2":"D","3":"RESOR"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This issue with formatting exists across this entire dataset. To ensure that similar entities appear in the right buckets when we aggregate the data, we are going to standardize capitalization across the whole dataset. We’re also going to leave out the practitioner’s middle initial since it is not always included (or included in the same way).</p>
</section>
<section id="question-2" class="level6">
<h6 class="anchored" data-anchor-id="question-2">Question</h6>
<div class="question">
<p>Write code to <code>mutate</code> <code>across</code> all <em>character</em> columns such that strings in these columns are converted to <strong>title case</strong>. Title case refers to casing where the first letter in each word is capitalized and all other letters are lowercase. Strings can be converted to title case with the function <code>str_to_title</code>. After you’ve done this, mutate a new column called <code>covered_recipient_full_name</code> that concatenates (hint: i.e.&nbsp;<em>pastes</em>) together <code>covered_recipient_first_name</code> and <code>covered_recipient_last_name</code>. Store the result in <code>open_payments_cleaned</code>.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>open_payments <span class="ot">&lt;-</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  open_payments_dates_cleaned <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), str_to_title)) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">covered_recipient_full_name =</span> <span class="fu">paste</span>(covered_recipient_first_name,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                                             covered_recipient_last_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we saw before, one <code>covered_recipient_npi</code> was associated with multiple names if the names were capitalized in some cases and not others. Now that we’ve standardized the formatting of these names, there ideally should be one full name associated with every <code>covered_recipient_npi</code>. Let’s compare the length of unique <code>covered_recipient_npi</code> values to the length of unique <code>covered_recipient_npi</code> to check whether this is the case.</p>
</section>
<section id="question-3" class="level6">
<h6 class="anchored" data-anchor-id="question-3">Question</h6>
<div class="question">
<p>Write a function below called <code>num_unique</code>. The function should calculate the length of unique values in the vector passed to the argument <code>x</code>. Below, I’ve selected the two columns in <code>open_payments</code> that we want to iterate this function over. Determine which <code>map()</code> function to use in order to return a numeric <strong>vector</strong> that indicates the length of unique values in each of these columns. If you’ve done everything correctly, you should get the output below.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>num_unique <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">unique</span>(x))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>open_payments <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(covered_recipient_npi, covered_recipient_full_name) <span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_int</span>(num_unique)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      covered_recipient_npi covered_recipient_full_name 
                      11837                       11858 </code></pre>
</div>
</div>
<p>Notice that there are still more full names than <code>covered_recipient_npi</code>s, which means that certain doctors have multiple names in this dataset. Below I’ve written some code to calculate the number unique full names listed for each <code>covered_recipient_npi</code> and filter to the rows with more than one name. Can you identify some reasons why we might have multiple names listed for this same medical practitioner in this data frame?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>open_payments <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(covered_recipient_npi) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_names =</span> <span class="fu">length</span>(<span class="fu">unique</span>(covered_recipient_full_name))) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_names <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(covered_recipient_npi, covered_recipient_full_name) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(covered_recipient_npi))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["covered_recipient_npi"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["covered_recipient_full_name"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"1992991657","2":"Lana Schumacher"},{"1":"1992991657","2":"Lana Beal"},{"1":"1992932453","2":"Jessica Allegretti"},{"1":"1992932453","2":"Jessica Ravikoff"},{"1":"1992712178","2":"Pasi Antero Janne"},{"1":"1992712178","2":"Pasi Janne"},{"1":"1992187132","2":"Faiz Bayo-Awoyemi"},{"1":"1992187132","2":"Faiz Bayo Awoyemi"},{"1":"1982680740","2":"Donald Marks"},{"1":"1982680740","2":"Don Marks"},{"1":"1982655643","2":"C. Douglas Evans"},{"1":"1982655643","2":"Charles Evans"},{"1":"1982655643","2":"C Douglas Evans"},{"1":"1982632006","2":"Lucyna Czarnota Dolliver"},{"1":"1982632006","2":"Lucyna Czarnota-Dolliver"},{"1":"1972661064","2":"Marie-Helene Almonor"},{"1":"1972661064","2":"Mariehelene Almonor"},{"1":"1962851345","2":"Jessica St. John"},{"1":"1962851345","2":"Jessica St John"},{"1":"1962516757","2":"Douglas Grogan"},{"1":"1962516757","2":"Dougals Grogan"},{"1":"1962465070","2":"James Obrien"},{"1":"1962465070","2":"James O'brien"},{"1":"1962437061","2":"Annie Abraham"},{"1":"1962437061","2":"Ann Abraham"},{"1":"1952364523","2":"Krzysztof Kacprzak"},{"1":"1952364523","2":"Krxysztof Kacprzak"},{"1":"1942650700","2":"James St Clair"},{"1":"1942650700","2":"James St. Clair"},{"1":"1942297528","2":"M. Donnelly"},{"1":"1942297528","2":"Mary Donnelly"},{"1":"1942250501","2":"Marie-Claire Maroun"},{"1":"1942250501","2":"Marie Claire Maroun"},{"1":"1922150804","2":"Raafat Attia-Hanna"},{"1":"1922150804","2":"Raafat Attia Hanna"},{"1":"1922101294","2":"Thomas O'halloran"},{"1":"1922101294","2":"Thomas O Halloran"},{"1":"1922040666","2":"Yousef Abou-Allaban"},{"1":"1922040666","2":"Yousef Abou Allaban"},{"1":"1912978644","2":"Christopher Bechara"},{"1":"1912978644","2":"Christoph Bechara"},{"1":"1891018065","2":"Christoph Zimmerman"},{"1":"1891018065","2":"Christopher Zimmerman"},{"1":"1881709111","2":"Andreluiz D'avila"},{"1":"1881709111","2":"Andre D'avila"},{"1":"1881709111","2":"Andre Davila"},{"1":"1861481657","2":"Paul Skudder"},{"1":"1861481657","2":"Paul Skudder Jr"},{"1":"1851573893","2":"Stella Lee"},{"1":"1851573893","2":"Estelle Lee"},{"1":"1851300230","2":"Angela Ahuja"},{"1":"1851300230","2":"Angel Ahuja"},{"1":"1831283118","2":"Maria Pilar Elisa Dayaw"},{"1":"1831283118","2":"Maria Dayaw"},{"1":"1821197641","2":"Camille Guzek-Latka"},{"1":"1821197641","2":"Camille Guzek Latka"},{"1":"1821107269","2":"Thomas Odonnell"},{"1":"1821107269","2":"Thomas O'donnell"},{"1":"1821023912","2":"Maria Gorbovitsky"},{"1":"1821023912","2":"Mary Gorbovitsky"},{"1":"1801887997","2":"Shih-Te Wen"},{"1":"1801887997","2":"Shih Te Wen"},{"1":"1801883806","2":"Robert Oleary"},{"1":"1801883806","2":"Robert O'leary"},{"1":"1801882667","2":"Brad Foster"},{"1":"1801882667","2":"Bradley Foster"},{"1":"1801834395","2":"Thirupaimruth Raman"},{"1":"1801834395","2":"Thirupaimaruth Raman"},{"1":"1780624213","2":"William Wyman Fiske"},{"1":"1780624213","2":"William Fiske"},{"1":"1770594905","2":"Richard Traversy"},{"1":"1770594905","2":"Richard Traversy Jr"},{"1":"1760589147","2":"Shiao-Ang Shih"},{"1":"1760589147","2":"Shiao Ang Shih"},{"1":"1750791380","2":"Vicky Thakkar"},{"1":"1750791380","2":"Vick Thakkar"},{"1":"1750360657","2":"David Rishikof"},{"1":"1750360657","2":"Dave Rishikof"},{"1":"1750357430","2":"Ron Alterman"},{"1":"1750357430","2":"Ronnie Alterman"},{"1":"1730179623","2":"Andrew David Simkin"},{"1":"1730179623","2":"Andrew Simkin"},{"1":"1720005481","2":"Kathleen Kirchmeier Kroessler"},{"1":"1720005481","2":"Kathleen Kirchmeier-Kroessler"},{"1":"1710969050","2":"Kala Seetharman"},{"1":"1710969050","2":"Kala Seetharaman"},{"1":"1710379797","2":"Marleny Aquino-Cabrera"},{"1":"1710379797","2":"Marleny Aquino Cabrera"},{"1":"1700864303","2":"James O'holleran"},{"1":"1700864303","2":"James Oholleran"},{"1":"1699881516","2":"Mercedes Von Deck"},{"1":"1699881516","2":"Mercedes Vondeck"},{"1":"1689197196","2":"Nazanin Asvadi"},{"1":"1689197196","2":"Nazanin Hajarol Asvadi"},{"1":"1689104010","2":"Jenny Zhao Cheng"},{"1":"1689104010","2":"Jenny Cheng"},{"1":"1679554588","2":"Matthew Smith"},{"1":"1679554588","2":"Mathew Smith"},{"1":"1669495602","2":"Jon Wee"},{"1":"1669495602","2":"Jonny Wee"},{"1":"1659471191","2":"Maryann Millar"},{"1":"1659471191","2":"Mary Ann Millar"},{"1":"1639150592","2":"Claude Resil"},{"1":"1639150592","2":"Claud Resil"},{"1":"1629098496","2":"Mohamad Och"},{"1":"1629098496","2":"Mohamed Och"},{"1":"1629044862","2":"L. Dolgov"},{"1":"1629044862","2":"L Dolgov"},{"1":"1629003686","2":"Elise Bilodeau Mccarthy"},{"1":"1629003686","2":"Elise Mccarthy"},{"1":"1619297124","2":"Nicole Grossman"},{"1":"1619297124","2":"Nicole Landzberg"},{"1":"1619045929","2":"Bao-Kim Nguyen"},{"1":"1619045929","2":"Bao Kim Nguyen"},{"1":"1609048909","2":"Hector Aguilar"},{"1":"1609048909","2":"Hector Tamez Aguilar"},{"1":"1598723512","2":"Soheil Amin Hanjani"},{"1":"1598723512","2":"Soheil Amin-Hanjani"},{"1":"1598711160","2":"Karl D'silva"},{"1":"1598711160","2":"Karl Dsilva"},{"1":"1588778476","2":"Slavenka Kam Hansen"},{"1":"1588778476","2":"Slavenka Kam-Hansen"},{"1":"1588722979","2":"Adnan El-Amine"},{"1":"1588722979","2":"Adnan El Amine"},{"1":"1588715882","2":"Salvatore Napoli"},{"1":"1588715882","2":"Salvador Napoli"},{"1":"1588616775","2":"Kimberly Mooney Mcnulty"},{"1":"1588616775","2":"Kimberly Mooney-Mcnulty"},{"1":"1578510392","2":"Claude-Laurent Sader"},{"1":"1578510392","2":"Claude Laurent Sader"},{"1":"1568879294","2":"Venugopal Bhattad"},{"1":"1568879294","2":"Venugopal B Bhattad"},{"1":"1568566420","2":"Robert O'brien"},{"1":"1568566420","2":"Robert Obrien"},{"1":"1568466316","2":"Frederick Ruymann"},{"1":"1568466316","2":"Fred Ruymann"},{"1":"1558532689","2":"Allen L Hwang"},{"1":"1558532689","2":"Allen Hwang"},{"1":"1548227960","2":"Christoph Cannon"},{"1":"1548227960","2":"Christopher Cannon"},{"1":"1538436209","2":"Santiago Lozano Calderon"},{"1":"1538436209","2":"Santiago Lozano-Calderon"},{"1":"1538415526","2":"Krzysztof Rosadzinsk"},{"1":"1538415526","2":"Krzysztof Rosadzinski"},{"1":"1528265824","2":"Kathyrn Masselam Hatch"},{"1":"1528265824","2":"Kathryn Masselam Hatch"},{"1":"1528094372","2":"Vanessa Vanstee"},{"1":"1528094372","2":"Vanessa Van Stee"},{"1":"1528072972","2":"Susan Freedman"},{"1":"1528072972","2":"Sue Freedman"},{"1":"1518915784","2":"Maureen Maher"},{"1":"1518915784","2":"Maureen Burns"},{"1":"1518278449","2":"Bianca Thorpe"},{"1":"1518278449","2":"Bianca Caetano"},{"1":"1518278290","2":"Laura Amorese-O'connell"},{"1":"1518278290","2":"Laura Amorese-Oconnell"},{"1":"1518278290","2":"Laura Amorese Fernandez"},{"1":"1508824475","2":"Nina Blumenthal"},{"1":"1508824475","2":"Nina Carol Blumenthal"},{"1":"1508437492","2":"Maria Alejandra Luna Cuadros"},{"1":"1508437492","2":"Maria Luna Cuadros"},{"1":"1508021544","2":"Jedsian Cheng"},{"1":"1508021544","2":"Jed-Sian Cheng"},{"1":"1497740351","2":"Clifford Prestia"},{"1":"1497740351","2":"Cliff Prestia"},{"1":"1487975157","2":"Ting Xu"},{"1":"1487975157","2":"Ting Yu Xu"},{"1":"1487693479","2":"Lee Silk"},{"1":"1487693479","2":"Lee Scott Silk"},{"1":"1487692786","2":"Feroze-Ud-Din Mahmood"},{"1":"1487692786","2":"Feroze Ud Din Mahmood"},{"1":"1477609923","2":"Amir Mohsen Mahoozi"},{"1":"1477609923","2":"Amir Mahoozi"},{"1":"1477596799","2":"K V R Mohan Rao"},{"1":"1477596799","2":"Kvr Mohan Rao"},{"1":"1477596799","2":"K.v.r Mohan Rao"},{"1":"1477043610","2":"Sneha Shah"},{"1":"1477043610","2":"Sneha Bavaji"},{"1":"1447248042","2":"Ann Marie Joyce"},{"1":"1447248042","2":"Ann Joyce"},{"1":"1437413242","2":"Jerry Chi Chuan Fang"},{"1":"1437413242","2":"Jerry Fang"},{"1":"1437307907","2":"Jessica Erdmann Sager"},{"1":"1437307907","2":"Jessica Erdmann-Sager"},{"1":"1437118627","2":"Mary-Ellen Taplin"},{"1":"1437118627","2":"Maryellen Taplin"},{"1":"1427499615","2":"Jaeyoung Lee"},{"1":"1427499615","2":"Jae Lee"},{"1":"1427365444","2":"Bernadete Therriault Campos"},{"1":"1427365444","2":"Bernadete Campos"},{"1":"1427056795","2":"Kelly Ocallahan"},{"1":"1427056795","2":"Kelly O Callahan"},{"1":"1417959610","2":"M. Wajid Baig"},{"1":"1417959610","2":"M Wajid Baig"},{"1":"1407803299","2":"Vani Reddi"},{"1":"1407803299","2":"Vani Sree Reddi"},{"1":"1396056495","2":"Josie Pena-Gomez"},{"1":"1396056495","2":"Josie Pena Gomez"},{"1":"1376525063","2":"Gloriane Afonso-Fede"},{"1":"1376525063","2":"Gloriane Afonso Fede"},{"1":"1376505222","2":"Gloria Moussa Gabour"},{"1":"1376505222","2":"Gloria Moussa-Gabour"},{"1":"1366440794","2":"Mohamad El Zaru"},{"1":"1366440794","2":"Mohamad El-Zaru"},{"1":"1356401871","2":"Domenic D'angelo"},{"1":"1356401871","2":"Domenic Dangelo"},{"1":"1326149741","2":"Colette Haag Rickert"},{"1":"1326149741","2":"Colette Haag-Rickert"},{"1":"1326085366","2":"Michelle O'donoghue"},{"1":"1326085366","2":"Michelle Odonoghue"},{"1":"1306168315","2":"Rosa Rincon - Rivero"},{"1":"1306168315","2":"Rosa Rincon-Rivero"},{"1":"1295723724","2":"M. Marshall"},{"1":"1295723724","2":"Margaret Marshall"},{"1":"1285690479","2":"Brandon Earp"},{"1":"1285690479","2":"Branden Earp"},{"1":"1275570228","2":"Lori Michelle Laffel"},{"1":"1275570228","2":"Lori Laffel"},{"1":"1265424758","2":"Stephanie Paris-Whitney"},{"1":"1265424758","2":"Stephanie Paris Whitney"},{"1":"1255308672","2":"Young-Ho Oh"},{"1":"1255308672","2":"Young Oh"},{"1":"1245694645","2":"Jacquelyn Dunahoe"},{"1":"1245694645","2":"Jacquelyn Holt"},{"1":"1245642438","2":"Kayla O Malley"},{"1":"1245642438","2":"Kayla O'malley"},{"1":"1245346162","2":"Lilian Mikael"},{"1":"1245346162","2":"Lily Mikael"},{"1":"1225010176","2":"Robert Schiffman"},{"1":"1225010176","2":"Robert Schiffmann"},{"1":"1215976741","2":"Linda Brown"},{"1":"1215976741","2":"Linda Farnsworth Brown"},{"1":"1205179777","2":"Narjust Duma"},{"1":"1205179777","2":"Narjust Perez Florez"},{"1":"1184682759","2":"Deepthi Desilva"},{"1":"1184682759","2":"Deepthi De Silva"},{"1":"1184614414","2":"Agnes Virga"},{"1":"1184614414","2":"Aggy Virga"},{"1":"1174510465","2":"Kimberly Browne-Martin"},{"1":"1174510465","2":"Kimberly Browne Martin"},{"1":"1154847945","2":"Ayita Ray"},{"1":"1154847945","2":"Ray Ayita"},{"1":"1144207408","2":"Michael Paasche-Orlow"},{"1":"1144207408","2":"Michael Paasche Orlow"},{"1":"1134322456","2":"Lawerence Baitch"},{"1":"1134322456","2":"Lawrence Baitch"},{"1":"1124414958","2":"Areen Al-Taie"},{"1":"1124414958","2":"Areen Altaie"},{"1":"1093821092","2":"Nora Schwartz-Martin"},{"1":"1093821092","2":"Nora Schwartz Martin"},{"1":"1093741530","2":"Maura Trail-O'brien"},{"1":"1093741530","2":"Maura Trail Obrien"},{"1":"1083719371","2":"Cheryl Depalo Jost"},{"1":"1083719371","2":"Cheryl Depaolo Jost"},{"1":"1083096358","2":"Syed Owais"},{"1":"1083096358","2":"Syed M Khurram Owais"},{"1":"1073595260","2":"Aboualkheir Alzaim"},{"1":"1073595260","2":"Aboualkhe Alzaim"},{"1":"1073567749","2":"Farrokh Khajavi-Noori"},{"1":"1073567749","2":"Farrokh Khajavi Noori"},{"1":"1073521753","2":"Stephen Kajencki"},{"1":"1073521753","2":"S. Kajencki"},{"1":"1073503603","2":"Alexandra Kimball"},{"1":"1073503603","2":"Alexandria Kimball"},{"1":"1063471126","2":"S David Miller"},{"1":"1063471126","2":"S Miller"},{"1":"1053755611","2":"Margo Rockwell"},{"1":"1053755611","2":"Margo Stevenson"},{"1":"1053368324","2":"Rebecca Osullivan Hunnewell"},{"1":"1053368324","2":"Rebecca Osullivan-Hunnewell"},{"1":"1033472352","2":"Erin O'shea"},{"1":"1033472352","2":"Erin O'shea Paudel"},{"1":"1033194048","2":"Paul D'ambrosio"},{"1":"1033194048","2":"Paul Dambrosio"},{"1":"1033169610","2":"Khalilull Khatri"},{"1":"1033169610","2":"Khalil Khatri"},{"1":"1023454279","2":"Rahman Fareed"},{"1":"1023454279","2":"Fareed Riyaz"},{"1":"1023281532","2":"Deborah Jean Pedersen"},{"1":"1023281532","2":"Deborah Pedersen"},{"1":"1023006525","2":"Peggy Mentor Saint Croix"},{"1":"1023006525","2":"Peggy Mentor"},{"1":"1013356971","2":"Yun- Ting Eric Yeh"},{"1":"1013356971","2":"Yun-Ting Yeh"},{"1":"1003848532","2":"John Joseph Looney"},{"1":"1003848532","2":"John Looney"},{"1":"1003367145","2":"Melda Gerow"},{"1":"1003367145","2":"Melda Esendal"},{"1":"1003260761","2":"Ellie Sader"},{"1":"1003260761","2":"Elie Sader"},{"1":"1003229097","2":"Kiran Agarwal-Harding"},{"1":"1003229097","2":"Kiran Agarwal Harding"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Because of these issues, it is important that we use the <code>covered_recipient_npi</code> to identify doctors vs.&nbsp;the full name.</p>
<p>Now that we have a final cleaned up <code>open_payments</code> data frame, let’s remove the other data frames from our environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(open_payments_original, open_payments_dates_cleaned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>…and on to analysis.</p>
</section>
</section>
<section id="data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis">Data Analysis</h2>
<p>Ultimately, our aim is to produce a number of tables and plots <em>for each of the ten MA-based doctors that received the most money from medical drug and device companies in 2021.</em> This means that one of our first analysis steps is to identify those 10 medical practitioners.</p>
<section id="question-4" class="level6">
<h6 class="anchored" data-anchor-id="question-4">Question</h6>
<div class="question">
<p>Write code to determine the 10 medical practitioners that received the most money from drug and device companies in 2021, and store your results in <code>top_10_doctors</code>. Your final data frame should have 10 rows and columns for <code>covered_recipient_npi</code> and <code>sum_total_payments</code>.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>top_10_doctors <span class="ot">&lt;-</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  open_payments <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(covered_recipient_npi) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sum_total_payments =</span> <span class="fu">sum</span>(total_amount_of_payment_usdollars)) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(sum_total_payments)) <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Right now the values that we will eventually want to iterate over in our analysis are stored as columns in a dataframe. …but remember that the family of <code>purrr</code> functions allows us to apply a function to each element of a vector or list. We want to create a series of vectors from these columns that we can iterate over. We will use the <code>pull()</code> function to do this.</p>
</section>
<section id="question-5" class="level6">
<h6 class="anchored" data-anchor-id="question-5">Question</h6>
<div class="question">
<p>Create a vector of <code>top_10_doctors_ids</code> from <code>top_10_doctors</code>, using the <code>pull()</code> function.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>top_10_doctors_ids <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  top_10_doctors <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(covered_recipient_npi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also want a vector of doctor names associated with each of these IDs, but remember that there can be multiple names for a single doctor in this dataset. With this in mind, we are going to create a vector of the <strong>first listed name</strong> for a given <code>covered_recipient_npi</code> in the dataset. Taking the first listed name as the doctor’s name is an imperfect solution. The first listed name could be a misspelling. It could be a doctor’s maiden name that they have since changed. We would want to confirm that we have the correct name for each doctor before publishing any of these findings.</p>
</section>
<section id="question-6" class="level6">
<h6 class="anchored" data-anchor-id="question-6">Question</h6>
<div class="question">
<p>Create a vector containing the names of the doctors associated with the IDs in <code>top_10_doctors_ids</code>. First, define the function <code>get_doctor_name</code>. This function will: - take a <code>doctor_id</code> as an argument, - filter <code>open_payments</code> to that ID, - summarize the <code>first()</code> <code>covered_recipient_full_name</code> listed for that ID, - <code>pull()</code> the name value</p>
<p>Once this function has been defined, select the appropriate <code>map()</code> function to iterate <code>top_10_doctors_ids</code> through <code>get_doctor_name</code> and store the resulting <strong>character vector</strong> in <code>top_10_doctors_names</code>.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>get_doctor_name <span class="ot">&lt;-</span> <span class="cf">function</span>(doctor_id){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  open_payments <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> doctor_id) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">name =</span> <span class="fu">first</span>(covered_recipient_full_name)) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>()</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>top_10_doctors_names <span class="ot">&lt;-</span> <span class="fu">map_chr</span>(top_10_doctors_ids, get_doctor_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have the vectors we want to iterate over, we are ready to start defining our first functions. To get started, let’s define a function that filters <code>open_payments</code> to a given doctor ID, and then calculates how much of each kind of payment has been paid to that doctor. Here is an example of what that data wrangling code would look like for a specific <code>covered_recipient_npi</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>open_payments <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> <span class="dv">1194763482</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nature_of_payment_or_transfer_of_value) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_payments =</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sum</span>(number_of_payments_included_in_total_amount),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_payments =</span> <span class="fu">sum</span>(total_amount_of_payment_usdollars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["nature_of_payment_or_transfer_of_value"],"name":[1],"type":["chr"],"align":["left"]},{"label":["num_payments"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["total_payments"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Consulting Fee","2":"4","3":"5427.5"},{"1":"Royalty Or License","2":"2","3":"18750000.0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="question-7" class="level6">
<h6 class="anchored" data-anchor-id="question-7">Question</h6>
<div class="question">
<p>Wrap the above code in a function named <code>calculate_payment_type_amts</code>. Rather than filtering to 1194763482, filter based on the value passed to an argument named <code>doctor_id</code>. Finally, use the <code>map()</code> function to apply <code>calculate_payment_type_amts</code> to each element in the <code>top_10_doctors_ids</code> vector. Running this code should return a list of 10 data frames.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>calculate_payment_type_amts <span class="ot">&lt;-</span> <span class="cf">function</span>(doctor_id){</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  open_payments <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> doctor_id) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(nature_of_payment_or_transfer_of_value) <span class="sc">|&gt;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">num_payments =</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sum</span>(number_of_payments_included_in_total_amount),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">total_payments =</span> <span class="fu">sum</span>(total_amount_of_payment_usdollars))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(top_10_doctors_ids, calculate_payment_type_amts) <span class="sc">|&gt;</span> <span class="fu">set_names</span>(top_10_doctors_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`David Friedman`
# A tibble: 2 × 3
  nature_of_payment_or_transfer_of_value num_payments total_payments
  &lt;chr&gt;                                         &lt;dbl&gt;          &lt;dbl&gt;
1 Consulting Fee                                    4          5428.
2 Royalty Or License                                2      18750000 

$`Martin Pollak`
# A tibble: 2 × 3
  nature_of_payment_or_transfer_of_value num_payments total_payments
  &lt;chr&gt;                                         &lt;dbl&gt;          &lt;dbl&gt;
1 Consulting Fee                                    1           1435
2 Royalty Or License                                2       18750000

$`Paul Tornetta`
# A tibble: 4 × 3
  nature_of_payment_or_transfer_of_value                         num_p…¹ total…²
  &lt;chr&gt;                                                            &lt;dbl&gt;   &lt;dbl&gt;
1 Compensation For Serving As Faculty Or As A Speaker For A Med…       1  2.5 e2
2 Food And Beverage                                                    3  7.09e1
3 Royalty Or License                                                  31  2.11e6
4 Travel And Lodging                                                   1  3.6 e1
# … with abbreviated variable names ¹​num_payments, ²​total_payments

$`Thomas Thornhill`
# A tibble: 2 × 3
  nature_of_payment_or_transfer_of_value num_payments total_payments
  &lt;chr&gt;                                         &lt;dbl&gt;          &lt;dbl&gt;
1 Consulting Fee                                    3          4050 
2 Royalty Or License                                5       1865801.

$`Laurie Glimcher`
# A tibble: 1 × 3
  nature_of_payment_or_transfer_of_value                         num_p…¹ total…²
  &lt;chr&gt;                                                            &lt;dbl&gt;   &lt;dbl&gt;
1 Compensation For Services Other Than Consulting, Including Se…       5 971882.
# … with abbreviated variable names ¹​num_payments, ²​total_payments

$`Ali Nasseh`
# A tibble: 2 × 3
  nature_of_payment_or_transfer_of_value num_payments total_payments
  &lt;chr&gt;                                         &lt;dbl&gt;          &lt;dbl&gt;
1 Food And Beverage                                 6           404.
2 Royalty Or License                               12        970887.

$`Alan Garber`
# A tibble: 5 × 3
  nature_of_payment_or_transfer_of_value                         num_p…¹ total…²
  &lt;chr&gt;                                                            &lt;dbl&gt;   &lt;dbl&gt;
1 Compensation For Services Other Than Consulting, Including Se…       5 423120 
2 Consulting Fee                                                       4 125000 
3 Current Or Prospective Ownership Or Investment Interest              1 400058 
4 Food And Beverage                                                   23   2265.
5 Travel And Lodging                                                   3   4495.
# … with abbreviated variable names ¹​num_payments, ²​total_payments

$`James Bono`
# A tibble: 4 × 3
  nature_of_payment_or_transfer_of_value num_payments total_payments
  &lt;chr&gt;                                         &lt;dbl&gt;          &lt;dbl&gt;
1 Consulting Fee                                    3          5500 
2 Food And Beverage                                12           986.
3 Royalty Or License                                4        810243.
4 Travel And Lodging                               18          3747.

$`Stephen Murphy`
# A tibble: 4 × 3
  nature_of_payment_or_transfer_of_value                         num_p…¹ total…²
  &lt;chr&gt;                                                            &lt;dbl&gt;   &lt;dbl&gt;
1 Compensation For Services Other Than Consulting, Including Se…       1   2156.
2 Consulting Fee                                                       2   1725 
3 Food And Beverage                                                    5    489.
4 Royalty Or License                                                   4 798660 
# … with abbreviated variable names ¹​num_payments, ²​total_payments

$`Michael Kaminer`
# A tibble: 4 × 3
  nature_of_payment_or_transfer_of_value  num_payments total_payments
  &lt;chr&gt;                                          &lt;dbl&gt;          &lt;dbl&gt;
1 Acquisitions                                       1        748350 
2 Consulting Fee                                     5         21810 
3 Food And Beverage                                 39           765.
4 Long Term Medical Supply Or Device Loan            1           437.</code></pre>
</div>
</div>
<p>Let’s take a similar approach to define a function that filters <code>open_payments</code> to a given doctor ID and determines how much doctors have been paid in relation to specific products they may be asked to endorse. To do so, we will need to aggregate the data by <code>name_of_drug_or_biological_or_device_or_medical_supply_1</code> and calculate the total payments associated with the mention of that product.</p>
<div class="question">
<p>Write a function named <code>calculate_drugs_and_devices_payments</code>. The function should take a <code>doctor_id</code>, and filter <code>open_payments</code> to that ID. Then it should aggregate the filtered data by <code>covered_recipient_full_name</code>, <code>name_of_drug_or_biological_or_device_or_medical_supply_1</code>, and <code>indicate_drug_or_biological_or_device_or_medical_supply_1</code>, calculate the total amount of payments, and sort the resulting data frame in descending order by the total amount of payments. Finally, use the <code>map()</code> function to apply <code>calculate_drugs_and_devices_payments</code> to each element in the <code>top_10_doctors_ids</code> vector. Running this code should return 10 data frames.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>calculate_drugs_and_devices_payments <span class="ot">&lt;-</span> <span class="cf">function</span>(doctor_id){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  open_payments <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> doctor_id) <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(name_of_drug_or_biological_or_device_or_medical_supply_1,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>             indicate_drug_or_biological_or_device_or_medical_supply_1) <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">total_amount_of_payment_usdollars =</span> <span class="fu">sum</span>(total_amount_of_payment_usdollars)) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(total_amount_of_payment_usdollars))</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(top_10_doctors_ids, calculate_drugs_and_devices_payments) <span class="sc">|&gt;</span> <span class="fu">set_names</span>(top_10_doctors_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`David Friedman`
# A tibble: 1 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [1]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 &lt;NA&gt;                                                     &lt;NA&gt;           1.88e7
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Martin Pollak`
# A tibble: 1 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [1]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 &lt;NA&gt;                                                     &lt;NA&gt;           1.88e7
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Paul Tornetta`
# A tibble: 6 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [6]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 Evos                                                     Device         1.69e6
2 Trigen Femoral (Fan/Tan/Meta Nail)                       Device         3.73e5
3 Vlp Mini Mod                                             Device         2.36e4
4 D-Rad Smart Pak                                          Device         1.78e4
5 Peri-Loc                                                 Device         1.08e4
6 &lt;NA&gt;                                                     &lt;NA&gt;           3.57e2
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Thomas Thornhill`
# A tibble: 1 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [1]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 Attune                                                   Device         1.87e6
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Laurie Glimcher`
# A tibble: 1 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [1]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 &lt;NA&gt;                                                     &lt;NA&gt;          971882.
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Ali Nasseh`
# A tibble: 3 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [3]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 &lt;NA&gt;                                                     &lt;NA&gt;           9.71e5
2 Channels Obturator                                       Device         1.08e2
3 Cao Group Inc Precise Ltm Complete Kit                   Device         9.68e1
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Alan Garber`
# A tibble: 1 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [1]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 &lt;NA&gt;                                                     &lt;NA&gt;          954938.
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`James Bono`
# A tibble: 5 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [5]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 Accolade                                                 Device        810243.
2 Mako                                                     Device          5319.
3 Triathlon                                                Device          2500 
4 &lt;NA&gt;                                                     &lt;NA&gt;            1415.
5 Surpass Evolve                                           Device           999.
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Stephen Murphy`
# A tibble: 4 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [4]
  name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_dr…¹ total…²
  &lt;chr&gt;                                                    &lt;chr&gt;           &lt;dbl&gt;
1 Mpo Hip System                                           Device        801074.
2 &lt;NA&gt;                                                     &lt;NA&gt;            1725 
3 Endurance                                                Device           120 
4 Hips-None                                                Device           112.
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars

$`Michael Kaminer`
# A tibble: 14 × 3
# Groups:   name_of_drug_or_biological_or_device_or_medical_supply_1 [14]
   name_of_drug_or_biological_or_device_or_medical_supply_1 indicate_d…¹ total…²
   &lt;chr&gt;                                                    &lt;chr&gt;          &lt;dbl&gt;
 1 &lt;NA&gt;                                                     &lt;NA&gt;          7.71e5
 2 Cosentyx                                                 Biological    1.23e2
 3 Cimzia                                                   Drug          9.51e1
 4 Humira                                                   Biological    7.59e1
 5 Enstilar                                                 Drug          6.77e1
 6 Dupixent                                                 Biological    5.64e1
 7 Taltz                                                    Drug          5.06e1
 8 Skyrizi                                                  Biological    4.88e1
 9 Ilumya                                                   Biological    4.71e1
10 Otezla                                                   Drug          4.08e1
11 Duobrii                                                  Drug          3.56e1
12 Tremfya                                                  Drug          2.77e1
13 Arazlo                                                   Drug          1.96e1
14 Enbrel                                                   Biological    1.79e1
# … with abbreviated variable names
#   ¹​indicate_drug_or_biological_or_device_or_medical_supply_1,
#   ²​total_amount_of_payment_usdollars</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>doctor_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(doctor_id){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  open_payments <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> doctor_id) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(covered_recipient_npi, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>             covered_recipient_full_name) <span class="sc">|&gt;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">num_payments =</span> <span class="fu">sum</span>(number_of_payments_included_in_total_amount),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">payment_total =</span> <span class="fu">sum</span>(total_amount_of_payment_usdollars),</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">num_companies =</span> <span class="fu">length</span>(<span class="fu">unique</span>(applicable_manufacturer_or_applicable_gpo_making_payment_id)))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">map_df</span>(top_10_doctors_ids, doctor_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["covered_recipient_npi"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["covered_recipient_full_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["num_payments"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["payment_total"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["num_companies"],"name":[5],"type":["int"],"align":["right"]}],"data":[{"1":"1194763482","2":"David Friedman","3":"6","4":"18755427.5","5":"1"},{"1":"1720096738","2":"Martin Pollak","3":"3","4":"18751435.0","5":"1"},{"1":"1073561973","2":"Paul Tornetta","3":"36","4":"2112833.4","5":"2"},{"1":"1699732065","2":"Thomas Thornhill","3":"8","4":"1869851.0","5":"1"},{"1":"1952351488","2":"Laurie Glimcher","3":"5","4":"971882.4","5":"2"},{"1":"1194860205","2":"Ali Nasseh","3":"18","4":"971290.7","5":"2"},{"1":"1225124787","2":"Alan Garber","3":"36","4":"954938.4","5":"2"},{"1":"1164598801","2":"James Bono","3":"37","4":"820475.7","5":"1"},{"1":"1144267899","2":"Stephen Murphy","3":"12","4":"803030.6","5":"3"},{"1":"1568424042","2":"Michael Kaminer","3":"46","4":"771362.4","5":"14"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>payment_calendar <span class="ot">&lt;-</span> <span class="cf">function</span>(doctor_id, doctor_name){</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  doctor_specialty <span class="ot">&lt;-</span> open_payments <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> doctor_id) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">specialty =</span> <span class="fu">first</span>(covered_recipient_specialty_1)) <span class="sc">|&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  open_payments <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(covered_recipient_npi <span class="sc">==</span> doctor_id) <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">day</span>(date_of_payment), <span class="at">y =</span> <span class="st">""</span>, <span class="at">col =</span> total_amount_of_payment_usdollars)) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> doctor_name, </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> doctor_specialty,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">""</span>, </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Day"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">col =</span> <span class="st">"Payment Amount"</span>) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">limits =</span> rev) <span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">"BuPu"</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(<span class="fu">month</span>(date_of_payment, <span class="at">label =</span> <span class="cn">TRUE</span>)), <span class="at">nrow =</span> <span class="dv">4</span>) </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(top_10_doctors_ids, top_10_doctors_names, payment_calendar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[9]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-9.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[10]]</code></pre>
</div>
<div class="cell-output-display">
<p><img src="lab8_files/figure-html/unnamed-chunk-16-10.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>