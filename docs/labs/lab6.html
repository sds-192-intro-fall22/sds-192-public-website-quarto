<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lindsay Poirier">

<title>Lab 6: Joining Datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">SDS 192: Intro to Data Science</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Syllabus</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../grading_contract.html">Standards Grading</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html">Schedule</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#learning-goals" id="toc-learning-goals" class="nav-link" data-scroll-target="#learning-goals">Learning Goals</a></li>
  </ul></li>
  <li><a href="#review-of-key-terms" id="toc-review-of-key-terms" class="nav-link" data-scroll-target="#review-of-key-terms">Review of Key Terms</a></li>
  <li><a href="#epas-echo" id="toc-epas-echo" class="nav-link" data-scroll-target="#epas-echo">EPA’s ECHO</a></li>
  <li><a href="#setting-up-your-environment" id="toc-setting-up-your-environment" class="nav-link" data-scroll-target="#setting-up-your-environment">Setting Up Your Environment</a></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis">Data Analysis</a>
  <ul class="collapse">
  <li><a href="#join-keys" id="toc-join-keys" class="nav-link" data-scroll-target="#join-keys">Join Keys</a></li>
  <li><a href="#joins" id="toc-joins" class="nav-link" data-scroll-target="#joins">Joins</a></li>
  <li><a href="#many-to-many-joins" id="toc-many-to-many-joins" class="nav-link" data-scroll-target="#many-to-many-joins">Many-to-Many Joins</a></li>
  <li><a href="#filtering-joins" id="toc-filtering-joins" class="nav-link" data-scroll-target="#filtering-joins">Filtering Joins</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 6: Joining Datasets</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lindsay Poirier </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In terms of data analysis, this lab has one goal: to determine the number of industrial facilities that are currently in violation of <strong>both</strong> the Clean Air Act and the Clean Water Act in California. To achieve this goal, we’re going to have to do some data wrangling and join together some datasets published by the EPA. We’re going to practice applying different types of joins to this data and consider what we learn with each.</p>
<section id="learning-goals" class="level3">
<h3 class="anchored" data-anchor-id="learning-goals">Learning Goals</h3>
<ul>
<li>Identify join keys</li>
<li>Discern the differences between types of joins</li>
<li>Discern what happens when we perform many-to-many joins</li>
<li>Apply filtering joins to identify missing data</li>
<li>Practice data wrangling</li>
</ul>
</section>
</section>
<section id="review-of-key-terms" class="level2">
<h2 class="anchored" data-anchor-id="review-of-key-terms">Review of Key Terms</h2>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may wish to reference this <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling Cheatsheet</a> when completing this lab.</p>
</div>
</div>
<dl>
<dt>Join Key</dt>
<dd>
<p>A variable shared across two datasets that identifies the observations that will be merged</p>
</dd>
</dl>
</section>
<section id="epas-echo" class="level2">
<h2 class="anchored" data-anchor-id="epas-echo">EPA’s ECHO</h2>
<p>The U.S. Environmental Protection Agency (EPA) is responsible for monitoring and regulating over 800,000 industrial facilities in the United States. This involves regularly inspecting facilities for their compliance with different environmental laws, issuing notices and taking enforcement actions when facilities are out of compliance, and issuing penalties for failures to address violations. A record of all of this activity is maintained online in a database known as ECHO - Enforcement and Compliance History Online. Specifically, ECHO maintains information about enforcement and compliance actions taken in relation to the Clean Air Act, the Clean Water Act, the Safe Drinking Water Act, and the Resource Conservation and Recovery Act.</p>
<p>There is so much information available to us via ECHO, and there is even an <code>R</code> package that makes it really simple to access the data in ECHO. However, because ECHO documents compliance with a number of different environmental laws, when we pull data from ECHO about regulated facilities, it is usually organized into separate tables for each law. Today we are going to pull a dataset documenting facilities’ compliance with the Clean Air Act and then pull a second dataset documenting facilities’ compliance with the Clean Water Act.</p>
<p>The Clean Air Act was first enacted in 1963 to regulate emissions from both stationary and mobile sources of air pollution. The Clean Water Act was enacted in 1972 regulate the polluting of U.S. waterways. When a facility violates one of these Acts, it typically means that they have released an excess amount of pollutants, neglected to implement the proper control technologies or standards, or failed to submit reports.</p>
</section>
<section id="setting-up-your-environment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-your-environment">Setting Up Your Environment</h2>
<ol type="1">
<li><p>Install the <code>echor</code> package in your Console.</p></li>
<li><p>Run the code below to load today’s data frames into your environment.</p></li>
</ol>
<div class="cell" data-document="show">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(echor)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>echo_air_ca <span class="ot">&lt;-</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">echoAirGetFacilityInfo</span>(<span class="at">p_st =</span> <span class="st">"CA"</span>, </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">qcolumns =</span> <span class="st">"1,4,5,8,48,99,100,101,102"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SourceID)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>echo_water_ca <span class="ot">&lt;-</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">echoWaterGetFacilityInfo</span>(<span class="at">p_st =</span> <span class="st">"CA"</span>, </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">qcolumns =</span> <span class="st">"1,4,5,9,184,185,186,187"</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SourceID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Run the code below to load the data dictionary for <code>echo_air_ca</code> into your environment.</li>
</ol>
<div class="cell" data-document="show">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>echo_air_dd <span class="ot">&lt;-</span> <span class="fu">echoAirGetMeta</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ColumnID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">99</span>,<span class="dv">100</span>,<span class="dv">101</span>,<span class="dv">102</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ColumnID, ObjectName, Description)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>echo_water_dd <span class="ot">&lt;-</span> <span class="fu">echoWaterGetMeta</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ColumnID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">184</span>,<span class="dv">185</span>,<span class="dv">186</span>,<span class="dv">187</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ColumnID, ObjectName, Description)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Open both <code>echo_air_dd</code> and <code>echo_water_dd</code> to review the data dictionaries for these datasets.</li>
</ol>
</section>
<section id="data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="data-analysis">Data Analysis</h2>
<section id="join-keys" class="level3">
<h3 class="anchored" data-anchor-id="join-keys">Join Keys</h3>
<p>When joining data frames, we need to determine a join key. This will be a variable that exists in both data frames to uniquely identify the data frames’ units of observation. This key needs to be shared across the two data frames in order to be able to join the data frames together. This is because when joining data frames, <code>R</code> will check the value in that variable for one data frame and look for the corresponding value in the key variable for the other data frame in order to determine which units of observation match across the data frames.</p>
<p>For instance, let’s say we have two data frames documenting the same group of students - one documents their current courses, and another documents their living arrangements. For both data frames, the student ID might serve as a join key. This ID uniquely identifies each student, and we expect that that key will be the same in both data frames (i.e.&nbsp;the 99- that represents you in one data frame will be the same as the 99- number that represents you in another data frame.) Because that number matches across the two data frames, we can use that variable to determine which rows (i.e.&nbsp;students) in the first data frame are associated with which rows in the second data frame.</p>
<section id="question" class="level6">
<h6 class="anchored" data-anchor-id="question">Question</h6>
<div class="question">
<p>Reference the data dictionaries for these two data frames to determine the names of the variables that we will join on. Remember that these should be variables that we can use to uniquely identify each unit of observation across the data frames. Write code below to determine the number of unique values for the variables you identify in each of these data frames. (Hint: Remember how we counted unique values in a variable in lab 1?)</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write code here for echo_air_ca</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Write code here for echo_water_ca</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
<section id="section" class="level7">
<p class="heading"></p>
<p>If you’ve done this correctly, you’ll learn that there are 2602 unique values <code>echo_air_ca</code>’s key variable. You’ll also learn that there are 28262 unique values in <code>echo_water_ca</code>’s key variable.</p>
<p>…but if you look in your environment, there are 2794 rows in <code>echo_air_ca</code>, and there are 30829 rows in <code>echo_water_ca</code>. This means that the key variable must repeat, and that certain facilities are represented more than once in each of these data frames.</p>
<p>This happens because even the EPA defines a facility in different ways depending on what laws it is regulated by. What counts as one facility in the Clean Air Act may count as two or three facilities in the Clean Water Act, but there is only one ID to document the relationships between them. This means that the same ID may show up a few times for different parts of the same facility. Check out some of the duplicating rows via my code below. Notice how multiple facilities - sometimes with entirely different names can be associated with the same RegistryID?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>echo_air_ca <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegistryID) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(RegistryID) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["AIRName"],"name":[1],"type":["chr"],"align":["left"]},{"label":["AIRCity"],"name":[2],"type":["chr"],"align":["left"]},{"label":["AIRState"],"name":[3],"type":["chr"],"align":["left"]},{"label":["RegistryID"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["AIRLastViolDate"],"name":[5],"type":["date"],"align":["right"]},{"label":["CurrSvFlag"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["ViolFlag"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["CurrVioFlag"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Insp5yrFlag"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"AVCORP COMPOSITE FABRICATION, INC","2":"GARDENA","3":"CA","4":"110000474665","5":"<NA>","6":"0","7":"0","8":"0","9":"1"},{"1":"HITCO CARBON COMPOSITES INC","2":"GARDENA","3":"CA","4":"110000474665","5":"<NA>","6":"0","7":"0","8":"0","9":"1"},{"1":"BALL METAL BEVERAGE CONTAINER CORP","2":"TORRANCE","3":"CA","4":"110000475192","5":"<NA>","6":"0","7":"0","8":"0","9":"0"},{"1":"BALL METALS","2":"TORRANCE","3":"CA","4":"110000475192","5":"<NA>","6":"0","7":"0","8":"0","9":"0"},{"1":"CUSTOM ALLOY METALS","2":"CITY OF INDUSTRY","3":"CA","4":"110000477939","5":"<NA>","6":"0","7":"0","8":"0","9":"0"},{"1":"LIGHT METALS INC","2":"CITY OF INDUSTRY","3":"CA","4":"110000477939","5":"<NA>","6":"0","7":"0","8":"0","9":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Later we will talk about what happens when we join two data frames that both have repeating keys, but for now, we’re going aggregate both of these data frames so that each Registry ID only appears once. Basically, we are going to write code to say: if any of the rows pertaining to this Registry ID document certain kinds of violations, set the violation flag for that facility to 1.</p>
</section>
</section>
<section id="question-1" class="level6">
<h6 class="anchored" data-anchor-id="question-1">Question</h6>
<div class="question">
<p>In the code below, for each of the data frames, you should group the data by <code>RegistryID</code> and then summarize by returning the <code>max()</code> value in <code>CurrSvFlag</code>, <code>ViolFlag</code>, <code>CurrVioFlag</code>, <code>Insp5yrFlag</code> for each group. Store the results in <code>echo_air_ca_agg</code> and <code>echo_water_ca_agg</code> respectively. Note how many rows in are in <code>echo_air_ca_agg</code> and <code>echo_water_ca_agg</code>. It should match the number of unique values in <code>RegistryID</code> that you calculated above.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>echo_air_ca_agg <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  echo_air_ca <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  ______ <span class="sc">|&gt;</span>             <span class="co">#group by RegistryID</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_____</span>(                <span class="co">#Summarize the following:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">CurrSvFlag =</span> _____, <span class="co">#Calculate max value in CurrSvFlag</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ViolFlag =</span> _____,   <span class="co">#Calculate max value in ViolFlag</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CurrVioFlag =</span> _____,<span class="co">#Calculate max value in CurrVioFlag</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Insp5yrFlag =</span> _____ <span class="co">#Calculate max value in Insp5yrFlag</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>echo_water_ca_agg <span class="ot">&lt;-</span> <span class="co">#Copy and adjust code above to create echo_water_ca_agg</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
</section>
</section>
<section id="joins" class="level3">
<h3 class="anchored" data-anchor-id="joins">Joins</h3>
<p>So now we have two data frames with unique registry IDs and variables indicating whether the facility has a current significant violation, whether it has had a violation in the past three years, whether it has a current violation, and whether it has been inspected in the past 5 years.</p>
<p>Now we want to join these two data frames together, so that we can check which facilities have violations to both the Clean Air Act and the Clean Water Act.</p>
<section id="question-2" class="level6">
<h6 class="anchored" data-anchor-id="question-2">Question</h6>
<div class="question">
<p>Write code below to perform four kinds of joins - a left join, a right join, and inner join, and a full join. <code>echo_water_ca_agg</code> should be in the first position, and <code>echo_air_ca_agg</code> should be joined onto it. I’ve started that for you in the commented code below.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#joined_left &lt;- echo_water_ca_agg |&gt; </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#joined_right &lt;- echo_water_ca_agg |&gt; </span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#joined_inner &lt;- echo_water_ca_agg |&gt; </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#joined_full &lt;- echo_water_ca_agg |&gt; </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
<section id="section-1" class="level7">
<p class="heading"></p>
<p>Check out the first six rows of <code>joined_full</code> below and note what happens when a <code>RegistryID</code> is present in one data frame but not in the other. We see data values in the columns associated with the data frame where the <code>RegistryID</code> was present, and <code>NA</code> values in the columns associated with the data frame where the <code>RegistryID</code> was not present. This is how we come to have so many extra rows in <code>joined_full</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>joined_full <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["RegistryID"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["CurrSvFlag.x"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["ViolFlag.x"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["CurrVioFlag.x"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Insp5yrFlag.x"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["CurrSvFlag.y"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["ViolFlag.y"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["CurrVioFlag.y"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Insp5yrFlag.y"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"110000473176","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"1"},{"1":"110000473247","2":"0","3":"0","4":"0","5":"0","6":"NA","7":"NA","8":"NA","9":"NA"},{"1":"110000473345","2":"0","3":"0","4":"0","5":"0","6":"NA","7":"NA","8":"NA","9":"NA"},{"1":"110000473372","2":"0","3":"0","4":"0","5":"0","6":"NA","7":"NA","8":"NA","9":"NA"},{"1":"110000473407","2":"0","3":"0","4":"0","5":"0","6":"NA","7":"NA","8":"NA","9":"NA"},{"1":"110000473434","2":"0","3":"0","4":"0","5":"1","6":"NA","7":"NA","8":"NA","9":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>With <code>joined_inner</code>, any rows associated with a <code>RegistryID</code> that doesn’t appear in <strong>both</strong> data frames get dropped. Check out the number of rows in <code>joined_inner</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(joined_inner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 739</code></pre>
</div>
</div>
<p>This represents the number of Registry IDs that were present in <strong>both</strong> <code>echo_water_ca_agg</code> and <code>echo_air_ca_agg</code>.</p>
</section>
</section>
<section id="question-3" class="level6">
<h6 class="anchored" data-anchor-id="question-3">Question</h6>
<div class="question">
<p>The three statements below are incorrect. Correct my statements below about the remaining joins.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(joined_full), <span class="st">"represents the number of Registry IDs present in echo_air_ca_agg"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(joined_left), <span class="st">"represents the number of Registry IDs present in either echo_air_ca_agg or echo_water_ca_agg"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="fu">nrow</span>(joined_right), <span class="st">"represents the number of Registry IDs present in echo_water_ca_agg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
<section id="section-2" class="level7">
<p class="heading"></p>
<p>From here on out, since we are only interested in the facilities with violations to both Acts, we are going to focus on <code>joined_inner</code>. Let’s remove the rest of the joined data frames from our environment.</p>
<div class="cell" data-document="show">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(joined_full, joined_left, joined_right)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You might note at this point that it can be difficult to tell which columns are associated with which environmental laws. This is because originally in both data frames, the variables we are most interested in (<code>CurrSvFlag</code>, <code>ViolFlag</code>, <code>CurrVioFlag</code>, <code>Insp5yrFlag</code>) shared the same names. When we joined these two data frames together, <code>R</code> opted to distinguish between them by tacking a <code>.x</code> onto the variable names for the data frame in the first position in the join and a <code>.y</code> onto the variable names for the data frame in the second position in the join. Let’s give each of these variables more meaningful names. To do so, we can use the <code>rename()</code> function, which is included in the <code>dplyr</code> package in the <code>tidyverse</code>. When piped to a dataframe, the formula for <code>rename()</code> is simple: <code>rename(new_name = old_name)</code></p>
</section>
</section>
<section id="question-4" class="level6">
<h6 class="anchored" data-anchor-id="question-4">Question</h6>
<div class="question">
<p>In my code below rename the remaining columns to differentiate between the column names from the two original data frames.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>joined_inner_renamed <span class="ot">&lt;-</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  joined_inner <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">CurrSvFlag_water =</span> CurrSvFlag.x,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ViolFlag_water =</span> ViolFlag.x </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Rename remaining columns here. Be sure to separate by comma. There are six more to go!</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
</section>
<section id="question-5" class="level6">
<h6 class="anchored" data-anchor-id="question-5">Question</h6>
<div class="question">
<p>Now that we have a cleaned up data frame, use a data wrangling verb to subset the data frame to the rows where a <code>RegistryID</code> has a <em>current violation</em> to both the Clean Water Act and Clean Air Act. Repeat these steps to determine which <code>RegistryID</code>s have a <em>significant violation</em> to both Acts. I recommend running this on <code>joined_inner_renamed</code>.</p>
<p>Once you’ve run these codes, open both <code>echo_air_ca</code> and <code>echo_water_ca</code> by clicking on the data frames in your environment. Search for a few of the <code>RegistryID</code>s that appeared in your analysis to identify the names and locations of the facilities.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Write wrangling code here for current violations. </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Write wrangling code here for significant violations. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
</section>
</section>
<section id="many-to-many-joins" class="level3">
<h3 class="anchored" data-anchor-id="many-to-many-joins">Many-to-Many Joins</h3>
<p>We don’t know much about these facilities because we lost a lot of critical information (e.g.&nbsp;the facility’s name and location) when aggregating our data by <code>RegistryID</code> above. At the time, we couldn’t aggregate by name because certain facilities sharing the same <code>RegistryID</code> had different names! Aggregating by name would have meant that we’d still have repeating <code>RegistryId</code>s in the data frame - one for each different version of the facility’s name.</p>
<p>The truth is though that we didn’t <strong>technically have to</strong> ensure that the <code>RegistryID</code> didn’t repeat. We can still join data frames in instances where the join key repeats in both data frames. This is called performing a <em>many-to-many</em> join because we are joining many of the same key in one data frame to many of the same key in another data frame. It’s important to pay attention to what happens when we make this join. Let’s look at an example: the facility with Registry ID 110001181186.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>echo_air_ca <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RegistryID <span class="sc">==</span> <span class="dv">110001181186</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["AIRName"],"name":[1],"type":["chr"],"align":["left"]},{"label":["AIRCity"],"name":[2],"type":["chr"],"align":["left"]},{"label":["AIRState"],"name":[3],"type":["chr"],"align":["left"]},{"label":["RegistryID"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["AIRLastViolDate"],"name":[5],"type":["date"],"align":["right"]},{"label":["CurrSvFlag"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["ViolFlag"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["CurrVioFlag"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Insp5yrFlag"],"name":[9],"type":["dbl"],"align":["right"]}],"data":[{"1":"DOS CUADRAS/SOUTH COUNTY/PLATFORM A","2":"CARPINTERIA","3":"CA","4":"110001181186","5":"<NA>","6":"0","7":"0","8":"0","9":"0"},{"1":"DOS CUADRAS/SOUTH COUNTY/PLATFORM B","2":"CARPINTERIA","3":"CA","4":"110001181186","5":"<NA>","6":"0","7":"0","8":"0","9":"0"},{"1":"DOS CUADRAS/SOUTH COUNTY/PLATFORM C","2":"CARPINTERIA","3":"CA","4":"110001181186","5":"<NA>","6":"0","7":"0","8":"0","9":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>echo_water_ca <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RegistryID <span class="sc">==</span> <span class="dv">110001181186</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["CWPName"],"name":[1],"type":["chr"],"align":["left"]},{"label":["CWPCity"],"name":[2],"type":["chr"],"align":["left"]},{"label":["CWPState"],"name":[3],"type":["chr"],"align":["left"]},{"label":["RegistryID"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["CurrSvFlag"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["ViolFlag"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["CurrVioFlag"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Insp5yrFlag"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"PLATFORM A","2":"PACIFIC OCEAN","3":"CA","4":"110001181186","5":"0","6":"0","7":"0","8":"0"},{"1":"PLATFORM B","2":"PACIFIC OCEAN","3":"CA","4":"110001181186","5":"0","6":"1","7":"0","8":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>In <code>echo_air_ca</code>, this <code>RegistryID</code> appears three times in the data frame, and in <code>echo_water_ca</code>, this <code>RegistryID</code> appears twice in the data frame. In each instance, the facility has a different name. What happens to facility 110001181186 when we perform a many-to-many join?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>echo_water_ca <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(echo_air_ca, <span class="at">by =</span> <span class="st">"RegistryID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(RegistryID <span class="sc">==</span> <span class="dv">110001181186</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(CWPName, AIRName, RegistryID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["CWPName"],"name":[1],"type":["chr"],"align":["left"]},{"label":["AIRName"],"name":[2],"type":["chr"],"align":["left"]},{"label":["RegistryID"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"PLATFORM A","2":"DOS CUADRAS/SOUTH COUNTY/PLATFORM A","3":"110001181186"},{"1":"PLATFORM A","2":"DOS CUADRAS/SOUTH COUNTY/PLATFORM B","3":"110001181186"},{"1":"PLATFORM A","2":"DOS CUADRAS/SOUTH COUNTY/PLATFORM C","3":"110001181186"},{"1":"PLATFORM B","2":"DOS CUADRAS/SOUTH COUNTY/PLATFORM A","3":"110001181186"},{"1":"PLATFORM B","2":"DOS CUADRAS/SOUTH COUNTY/PLATFORM B","3":"110001181186"},{"1":"PLATFORM B","2":"DOS CUADRAS/SOUTH COUNTY/PLATFORM C","3":"110001181186"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>This inner join created six rows for facility 110001181186. This is because <code>R</code> matched each of the three rows for facility 110001181186 in <code>echo_air_ca</code> with the two rows for facility 110001181186 in <code>echo_water_ca</code> (and 3 rows * 2 rows = 6 rows).</p>
<p>This is one of the reasons why it is important to understand the context of datasets and their units of observation. Here we’ve joined these rows together as if they represented matching facilities. …but just by looking at this output we know that PLATFORM A is going to be physically different than DOS CUADRAS/SOUTH COUNTY/PLATFORM B, and PLATFORM B is going to be physically different than DOS CUADRAS/SOUTH COUNTY/PLATFORM C. The only thing that they all share is that they are sub-parts of the facility with the <code>RegistryID</code> 110001181186. Ultimately the units of observation don’t match across these two data frames because Clean Air Act and Clean Water Act delineate facilities differently. By aggregating to <code>RegistryID</code> above - something shared across the two Acts - we <strong>standardized</strong> the unit of observation, which made it possible to perform a more meaningful join.</p>
<section id="question-6" class="level6">
<h6 class="anchored" data-anchor-id="question-6">Question</h6>
<div class="question">
<p>Using my code as an example, determine how many times facility 110000483619 appears in <code>echo_air_ca</code> and how many times it appears in <code>echo_water_ca</code>. How many times would this facility show up if we were to perform a many-to-many inner join for these two data frames? Write your response as a comment in the code chunk.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Write code here for echo_air_ca!</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Write code here for echo_water_ca!</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Write comment here!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
</section>
</section>
<section id="filtering-joins" class="level3">
<h3 class="anchored" data-anchor-id="filtering-joins">Filtering Joins</h3>
<p>Sometimes we want to know which observations that appear in one data frame <em>don’t</em> appear in another <em>data frame</em>. This might tell us where we have missing data. In this case, it will tell us which facilities are regulated by one environmental law and not the other.</p>
<section id="question-7" class="level6">
<h6 class="anchored" data-anchor-id="question-7">Question</h6>
<div class="question">
<p>Write code below to perform two <code>anti_join()</code>s. The first should tell me which facilities are regulated by the Clean Air Act and <em>not</em> the Clean Water Act, and the second should tell me which facilities are regulated by the Clean Water Act and <em>not</em> the Clean Air Act.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#not_clean_water &lt;- Write code here!</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#not_clean_air &lt;- Write code here!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-document="solutions">

</div>
<section id="section-3" class="level7">
<p class="heading"></p>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Ethical Considerations
</div>
</div>
<div class="callout-body-container callout-body">
<p>In March 2020, the Environmental Protection Agency published a memo that permitted industrial facilities impacted by the Covid-19 pandemic to temporarily suspend mandated pollution monitoring. Research published by the Environmental Data Governance Initiative (EDGI) <span class="citation" data-cites="nostMorePermissionPollute2020">(<a href="#ref-nostMorePermissionPollute2020" role="doc-biblioref">Nost et al. 2020</a>)</span> has indicated that, during this time, reported violations to the Clean Air Act and the Clean Water Act dropped considerably. However, EDGI’s report goes on to argue that violations were likely being under-counted at this time. …first, because facilities were not being required to monitor and report data to the same degree during Covid-19, and second, because the EPA was conducting fewer inspections during Covid-19. In sum, as they say, “the absence of data should not be taken as the absence of pollution.” What social harms emerge in the wake of these data absences? Who benefits from these policies, and who faces the greatest risks? How should we as data scientists think and act as we anaylze and present this data?</p>
</div>
</div>



</section>
</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-nostMorePermissionPollute2020" class="csl-entry" role="doc-biblioentry">
Nost, Eric, Kelsey Breseman, Steve Hansen, Leslie Alanis, Megan Raisle, Lourdes Vera, Maalvika Bhat, Sara Wylie, Sung-Gheel (Gil) Jang, and EDGI. 2020. <span>“More <span>Permission</span> to <span>Pollute</span>: <span>The Decline</span> of <span>EPA Enforcement</span> and <span>Industry Compliance</span> During <span>COVID</span>.”</span> <em>Ke</em>. <a href="https://envirodatagov.org/more-permission-to-pollute-the-decline-of-epa-enforcement-and-industry-compliance-during-covid/">https://envirodatagov.org/more-permission-to-pollute-the-decline-of-epa-enforcement-and-industry-compliance-during-covid/</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>